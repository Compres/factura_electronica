var Rollup=function(e){"use strict";function t(e,t,_){if("C/F"===e||"c/f"===e)_.enable_save();else{var a,o=0;if(a=/^(\d+)\-?([\dk])$/i.exec(e)){a[2]="k"==a[2].toLowerCase()?10:parseInt(a[2]);for(var c=0;c<a[1].length;c++)o+=(-1*(c-a[1].length)+1)*a[1][c];var s=(11-o%11)%11==a[2]}else s=!1;!1===s&&(frappe.show_alert({indicator:"orange",message:__("NIT de "+t+" no es correcto. Si no tiene disponible el NIT modifiquelo a C/F.")}),_.disable_save()),!0===s&&_.enable_save()}}function _(e,t,_){var a;"undefined"!==cur_frm.doc.taxes[0].rate&&(a=cur_frm.doc.taxes[0].rate);e.doc.items.forEach(function(t,o){if(t.name===_){t.amount,t.stock_qty,t.facelec_tax_rate_per_uom,t.stock_qty*t.facelec_tax_rate_per_uom,t.amount-t.stock_qty*t.facelec_tax_rate_per_uom,e.doc.items[o].facelec_other_tax_amount=t.facelec_tax_rate_per_uom*(t.qty*t.conversion_factor),e.doc.items[o].facelec_amount_minus_excise_tax=t.qty*t.rate-t.stock_qty*t.facelec_tax_rate_per_uom,e.refresh_field("items"),e.refresh_field("conversion_factor"),t.factelecis_fuel&&(e.doc.items[o].facelec_gt_tax_net_fuel_amt=t.facelec_amount_minus_excise_tax/(1+a/100),e.doc.items[o].facelec_sales_tax_for_this_row=t.facelec_gt_tax_net_fuel_amt*(a/100)),t.facelec_is_good&&(e.doc.items[o].facelec_gt_tax_net_goods_amt=t.facelec_amount_minus_excise_tax/(1+a/100),e.doc.items[o].facelec_sales_tax_for_this_row=t.facelec_gt_tax_net_goods_amt*(a/100)),t.facelec_is_service&&(e.doc.items[o].facelec_gt_tax_net_services_amt=t.facelec_amount_minus_excise_tax/(1+a/100),e.doc.items[o].facelec_sales_tax_for_this_row=t.facelec_gt_tax_net_services_amt*(a/100));var c=0;$.each(e.doc.items||[],function(e,t){t.facelec_sales_tax_for_this_row&&(c+=flt(t.facelec_sales_tax_for_this_row))}),console.log("El total de iva acumulado para la factura es: "+c),cur_frm.set_value("shs_total_iva_fac",c)}})}function a(e,t,a){e.doc.items.forEach(function(t){e.doc.facelec_total_iva;var a=e.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100);if("NaN"==typeof cur_frm.doc.taxes[0].rate);else{var o=a*(cur_frm.doc.taxes[0].rate/100);e.doc.facelec_total_iva=e.doc.facelec_total_iva-o}_(e,0,t.name),i(e,"Sales Invoice Item",t.name)})}function o(e,t){var _=0;return $.each(e.doc.items||[],function(e,a){a.facelec_tax_rate_per_uom_account===t&&(_+=flt(a.facelec_other_tax_amount))}),_}function c(e,t,_){e.doc.items.forEach(function(t,a){t.name===_&&t.facelec_tax_rate_per_uom_account&&e.doc.shs_otros_impuestos.forEach(function(_,a){if(_.account_head===t.facelec_tax_rate_per_uom_account){var c;c=o(e,_.account_head),cur_frm.doc.shs_otros_impuestos[a].total=c,s(e)}})})}function s(e){var t=0;$.each(e.doc.shs_otros_impuestos||[],function(e,_){_.account_head&&(t+=flt(_.total))}),cur_frm.set_value("shs_total_otros_imp_incl",t),e.refresh_field("shs_total_otros_imp_incl")}function i(e,t,_){var a=0;e.doc.items.forEach(function(t,o){if(t.name===_){t.stock_qty*t.facelec_tax_rate_per_uom,a=t.facelec_other_tax_amount;var s=t.facelec_tax_rate_per_uom_account;e.refresh_field("items"),e.refresh_field("conversion_factor"),s&&(!function(e,t){var _=!1;return $.each(e.doc.shs_otros_impuestos||[],function(e,a){a.account_head===t&&(_=!0)}),_}(e,s)?(frappe.model.add_child(cur_frm.doc,"Otros Impuestos Factura Electronica","shs_otros_impuestos"),cur_frm.refresh_field("items"),e.doc.shs_otros_impuestos.forEach(function(t,o){void 0===t.account_head&&(cur_frm.doc.shs_otros_impuestos[o].account_head=s,cur_frm.doc.shs_otros_impuestos[o].total=a,cur_frm.refresh_field("shs_otros_impuestos"),c(e,0,_),cur_frm.refresh_field("shs_otros_impuestos"))})):(c(e,0,_),cur_frm.refresh_field("shs_otros_impuestos")))}})}function r(e,t){t.add_custom_button(__("VER PDF FACTURA ELECTRONICA"),function(){window.open("https://www.ingface.net/Ingfacereport/dtefactura.jsp?cae="+e)}).addClass("btn-primary")}function n(e){e.add_custom_button(__("GUARDAR PDF"),function(){frappe.call({method:"factura_electronica.api.guardar_pdf_servidor",args:{nombre_archivo:e.doc.name,cae_de_factura_electronica:e.doc.cae_factura_electronica},callback:function(){e.reload_doc()}})}).addClass("btn-primary")}function f(e,t){t.add_custom_button(__(e),function(){t.reload_doc();var e=t.doc.name,_=window.location.href;frappe.call({method:"factura_electronica.api.generar_factura_electronica",args:{serie_factura:t.doc.name,nombre_cliente:t.doc.customer,pre_se:t.doc.naming_series},callback:function(a){if(void 0!==a.message){var o=_.replace(e,a.message);window.location.assign(o),t.reload_doc()}}})}).addClass("btn-primary")}function u(e){e.reload_doc();var t=e.doc.name,_=window.location.href;frappe.call({method:"factura_electronica.api.generar_factura_electronica",args:{serie_factura:e.doc.name,nombre_cliente:e.doc.customer,pre_se:e.doc.naming_series},callback:function(a){if(void 0!==a.message){var o=_.replace(t,a.message);window.location.assign(o),e.reload_doc()}else e.reload_doc()}})}function d(e,t,_,a){"Paid"!==t.doc.status&&"Unpaid"!==t.doc.status&&"Submitted"!==t.doc.status&&"Overdue"!==t.doc.status||(t.doc.cae_factura_electronica?(cur_frm.clear_custom_buttons(),r(t.doc.cae_factura_electronica,t),n(t)):("manual"===e&&f("Factura Electronica",t),"automatico"===e&&u(t))),"Return"===t.doc.status&&(t.doc.cae_factura_electronica?(cur_frm.clear_custom_buttons(),r(t.doc.cae_factura_electronica,t),n(t)):("manual"===e&&f("Nota Credito Electronica",t),"automatico"===e&&u(t))),"Paid"!==t.doc.status&&"Unpaid"!==t.doc.status&&"Submitted"!==t.doc.status&&"Overdue"!==t.doc.status||t.doc.es_nota_de_debito&&(cur_frm.clear_custom_buttons("Factura Electronica"),t.doc.cae_factura_electronica?(cur_frm.clear_custom_buttons(),r(t.doc.cae_factura_electronica,t),n(t)):("manual"===e&&f("Nota Debito Electronica",t),"automatico"===e&&u(t))),"Draft"===t.doc.status&&(cur_frm.set_value("cae_factura_electronica",""),cur_frm.set_value("serie_original_del_documento",""))}function l(e,t){return e*t}function m(e,t,_){e.doc.items.forEach(function(t){p(e,"Delivery Note Item",t.name)})}function p(e,t,_){cur_frm.refresh_fields();var a=cur_frm.doc.taxes[0].rate;e.doc.items.forEach(function(t,o){if(t.name==_){if(t.qty*t.rate,t.qty*t.conversion_factor,t.shs_dn_tax_rate_per_uom,e.doc.items[o].shs_dn_other_tax_amount=t.shs_dn_tax_rate_per_uom*(t.qty*t.conversion_factor),e.doc.items[o].shs_dn_amount_minus_excise_tax=t.qty*t.rate-t.qty*t.conversion_factor*t.shs_dn_tax_rate_per_uom,t.shs_dn_is_fuel){e.doc.items[o].shs_dn_gt_tax_net_fuel_amt=t.shs_dn_amount_minus_excise_tax/(1+a/100),e.doc.items[o].shs_dn_sales_tax_for_this_row=t.shs_dn_gt_tax_net_fuel_amt*(a/100);var c=0;$.each(e.doc.items||[],function(e,t){1==t.shs_dn_is_fuel&&(c+=flt(t.shs_dn_gt_tax_net_fuel_amt))}),e.doc.shs_dn_gt_tax_fuel=c}if(t.shs_dn_is_good){e.doc.items[o].shs_dn_gt_tax_net_goods_amt=t.shs_dn_amount_minus_excise_tax/(1+a/100),e.doc.items[o].shs_dn_sales_tax_for_this_row=t.shs_dn_gt_tax_net_goods_amt*(a/100);var s=0;$.each(e.doc.items||[],function(e,t){1==t.shs_dn_is_good&&(s+=flt(t.shs_dn_gt_tax_net_goods_amt))}),e.doc.shs_dn_gt_tax_goods=s}if(t.shs_dn_is_service){e.doc.items[o].shs_dn_gt_tax_net_services_amt=t.shs_dn_amount_minus_excise_tax/(1+a/100),e.doc.items[o].shs_dn_sales_tax_for_this_row=t.shs_dn_gt_tax_net_services_amt*(a/100);var i=0;$.each(e.doc.items||[],function(e,t){1==t.shs_dn_is_service&&(i+=flt(t.shs_dn_gt_tax_net_services_amt))}),e.doc.shs_dn_gt_tax_services=i}var r=0;$.each(e.doc.items||[],function(e,t){r+=flt(t.shs_dn_sales_tax_for_this_row)}),e.doc.shs_dn_total_iva=r}})}function h(e,t){return e*t}function v(e,t,_){e.doc.items.forEach(function(t){x(e,"Sales Order Item",t.name)})}function x(e,t,_){cur_frm.refresh_fields();var a=cur_frm.doc.taxes[0].rate;e.doc.items.forEach(function(t,o){if(t.name==_){if(t.qty*t.rate,t.qty*t.conversion_factor,t.shs_so_tax_rate_per_uom,e.doc.items[o].shs_so_other_tax_amount=t.shs_so_tax_rate_per_uom*(t.qty*t.conversion_factor),e.doc.items[o].shs_so_amount_minus_excise_tax=t.qty*t.rate-t.qty*t.conversion_factor*t.shs_so_tax_rate_per_uom,t.shs_so_is_fuel){e.doc.items[o].shs_so_gt_tax_net_fuel_amt=t.shs_so_amount_minus_excise_tax/(1+a/100),e.doc.items[o].shs_so_sales_tax_for_this_row=t.shs_so_gt_tax_net_fuel_amt*(a/100);var c=0;$.each(e.doc.items||[],function(e,t){1==t.shs_so_is_fuel&&(c+=flt(t.shs_so_gt_tax_net_fuel_amt))}),e.doc.shs_gt_tax_fuel=c}if(t.shs_so_is_good){e.doc.items[o].shs_so_gt_tax_net_goods_amt=t.shs_so_amount_minus_excise_tax/(1+a/100),e.doc.items[o].shs_so_sales_tax_for_this_row=t.shs_so_gt_tax_net_goods_amt*(a/100);var s=0;$.each(e.doc.items||[],function(e,t){1==t.shs_so_is_good&&(s+=flt(t.shs_so_gt_tax_net_goods_amt))}),e.doc.shs_so_gt_tax_goods=s}if(t.shs_so_is_service){e.doc.items[o].shs_so_gt_tax_net_services_amt=t.shs_so_amount_minus_excise_tax/(1+a/100),e.doc.items[o].shs_so_sales_tax_for_this_row=t.shs_so_gt_tax_net_services_amt*(a/100);var i=0;$.each(e.doc.items||[],function(e,t){1==t.shs_so_is_service&&(i+=flt(t.shs_so_gt_tax_net_services_amt))}),e.doc.shs_so_gt_tax_services=i}var r=0;$.each(e.doc.items||[],function(e,t){r+=flt(t.shs_so_sales_tax_for_this_row)}),e.doc.shs_so_total_iva=r}})}function g(e,t,_){e.doc.items.forEach(function(t){b(e,"Quotation Item",t.name),I(e,"Quotation Item",t.name)})}function q(e,t){var _=0;return $.each(e.doc.items||[],function(e,a){a.facelec_qt_tax_rate_per_uom_account===t&&(_+=flt(a.facelec_qt_other_tax_amount))}),_}function y(e,t,_){e.doc.items.forEach(function(t,a){t.name===_&&t.facelec_qt_tax_rate_per_uom_account&&e.doc.shs_tax_quotation.forEach(function(_,a){if(_.account_head===t.facelec_qt_tax_rate_per_uom_account){var o;o=q(e,_.account_head),cur_frm.doc.shs_tax_quotation[a].total=o,w(e)}})})}function w(e){var t=0;$.each(e.doc.shs_tax_quotation||[],function(e,_){_.account_head&&(t+=flt(_.total))}),cur_frm.set_value("shs_qt_total_otros_imp_incl",t),e.refresh_field("shs_qt_total_otros_imp_incl")}function I(e,t,_){var a=0;e.doc.items.forEach(function(t,o){if(t.name===_){a=t.facelec_qt_other_tax_amount;var c=t.facelec_qt_tax_rate_per_uom_account;e.refresh_field("items"),e.refresh_field("conversion_factor"),c&&(!function(e,t){var _=!1;return $.each(e.doc.shs_tax_quotation||[],function(e,a){a.account_head===t&&(_=!0)}),_}(e,c)?(frappe.model.add_child(cur_frm.doc,"Otros Impuestos Factura Electronica","shs_tax_quotation"),cur_frm.refresh_field("items"),e.doc.shs_tax_quotation.forEach(function(t,o){void 0===t.account_head&&(cur_frm.doc.shs_tax_quotation[o].account_head=c,cur_frm.doc.shs_tax_quotation[o].total=a,cur_frm.refresh_field("shs_tax_quotation"),y(e,0,_),cur_frm.refresh_field("shs_tax_quotation"))})):(y(e,0,_),cur_frm.refresh_field("shs_tax_quotation")))}})}function b(e,t,_){cur_frm.refresh_fields();var a=cur_frm.doc.taxes[0].rate;e.doc.items.forEach(function(t,o){if(t.name==_){if(t.qty*t.rate,t.qty*t.conversion_factor,t.facelec_qt_tax_rate_per_uom,e.doc.items[o].facelec_qt_other_tax_amount=t.facelec_qt_tax_rate_per_uom*(t.qty*t.conversion_factor),e.doc.items[o].facelec_qt_amount_minus_excise_tax=t.qty*t.rate-t.qty*t.conversion_factor*t.facelec_qt_tax_rate_per_uom,t.facelec_qt_is_fuel){e.doc.items[o].facelec_qt_gt_tax_net_fuel_amt=t.facelec_qt_amount_minus_excise_tax/(1+a/100),e.doc.items[o].facelec_qt_sales_tax_for_this_row=t.facelec_qt_gt_tax_net_fuel_amt*(a/100);var c=0;$.each(e.doc.items||[],function(e,t){1==t.facelec_qt_is_fuel&&(c+=flt(t.facelec_qt_gt_tax_net_fuel_amt))}),e.doc.facelec_qt_gt_tax_fuel=c}if(t.facelec_qt_is_good){e.doc.items[o].facelec_qt_gt_tax_net_goods_amt=t.facelec_qt_amount_minus_excise_tax/(1+a/100),e.doc.items[o].facelec_qt_sales_tax_for_this_row=t.facelec_qt_gt_tax_net_goods_amt*(a/100);var s=0;$.each(e.doc.items||[],function(e,t){1==t.facelec_qt_is_good&&(s+=flt(t.facelec_qt_gt_tax_net_goods_amt))}),e.doc.facelec_qt_gt_tax_goods=s}if(1==t.facelec_qt_is_service){e.doc.items[o].facelec_qt_gt_tax_net_services_amt=t.facelec_qt_amount_minus_excise_tax/(1+a/100),e.doc.items[o].facelec_qt_sales_tax_for_this_row=t.facelec_qt_gt_tax_net_services_amt*(a/100);var i=0;$.each(e.doc.items||[],function(e,t){1==t.facelec_qt_is_service&&(i+=flt(t.facelec_qt_gt_tax_net_services_amt))}),e.doc.facelec_qt_gt_tax_services=i}var r=0;$.each(e.doc.items||[],function(e,t){r+=flt(t.facelec_qt_sales_tax_for_this_row)}),e.doc.facelec_qt_total_iva=r}})}function k(e,t,_){e.doc.items.forEach(function(t){O(e,"Purchase Invoice Item",t.name),N(e,"Purchase Invoice Item",t.name)})}function E(e,t){var _=0;return $.each(e.doc.items||[],function(e,a){a.facelec_p_tax_rate_per_uom_account===t&&(_+=flt(a.facelec_p_other_tax_amount))}),_}function P(e,t,_){e.doc.items.forEach(function(t,a){t.name===_&&t.facelec_p_tax_rate_per_uom_account&&e.doc.shs_pi_otros_impuestos.forEach(function(_,a){if(_.account_head===t.facelec_p_tax_rate_per_uom_account){var o;o=E(e,_.account_head),cur_frm.doc.shs_pi_otros_impuestos[a].total=o,S(e)}})})}function S(e){var t=0;$.each(e.doc.shs_pi_otros_impuestos||[],function(e,_){_.account_head&&(t+=flt(_.total))}),cur_frm.set_value("shs_pi_total_otros_imp_incl",t),e.refresh_field("shs_pi_total_otros_imp_incl")}function N(e,t,_){var a=0;e.doc.items.forEach(function(t,o){if(t.name===_){a=t.facelec_p_other_tax_amount;var c=t.facelec_p_tax_rate_per_uom_account;e.refresh_field("items"),e.refresh_field("conversion_factor"),c&&(!function(e,t){var _=!1;return $.each(e.doc.shs_pi_otros_impuestos||[],function(e,a){a.account_head===t&&(_=!0)}),_}(e,c)?(frappe.model.add_child(cur_frm.doc,"Otros Impuestos Factura Electronica","shs_pi_otros_impuestos"),cur_frm.refresh_field("items"),e.doc.shs_pi_otros_impuestos.forEach(function(t,o){void 0===t.account_head&&(cur_frm.doc.shs_pi_otros_impuestos[o].account_head=c,cur_frm.doc.shs_pi_otros_impuestos[o].total=a,cur_frm.refresh_field("shs_pi_otros_impuestos"),P(e,0,_),cur_frm.refresh_field("shs_pi_otros_impuestos"))})):(P(e,0,_),cur_frm.refresh_field("shs_pi_otros_impuestos")))}})}function O(e,t,_){cur_frm.refresh_fields();var a=cur_frm.doc.taxes[0].rate;e.doc.items.forEach(function(t,o){t.name==_&&(t.qty*t.rate,t.qty*t.conversion_factor,t.facelec_p_tax_rate_per_uom,e.doc.items[o].facelec_p_other_tax_amount=t.facelec_p_tax_rate_per_uom*(t.qty*t.conversion_factor),e.doc.items[o].facelec_p_amount_minus_excise_tax=t.qty*t.rate-t.qty*t.conversion_factor*t.facelec_p_tax_rate_per_uom,t.facelec_p_is_fuel&&(e.doc.items[o].facelec_p_gt_tax_net_fuel_amt=t.facelec_p_amount_minus_excise_tax/(1+a/100),e.doc.items[o].facelec_p_sales_tax_for_this_row=t.facelec_p_gt_tax_net_fuel_amt*(a/100),total_fuel=0,$.each(e.doc.items||[],function(e,t){1==t.facelec_p_is_fuel&&(total_fuel+=flt(t.facelec_p_gt_tax_net_fuel_amt))}),e.doc.facelec_p_gt_tax_fuel=total_fuel),t.facelec_p_is_good&&(e.doc.items[o].facelec_p_gt_tax_net_goods_amt=t.facelec_p_amount_minus_excise_tax/(1+a/100),e.doc.items[o].facelec_p_sales_tax_for_this_row=t.facelec_p_gt_tax_net_goods_amt*(a/100),total_goods=0,$.each(e.doc.items||[],function(e,t){1==t.facelec_p_is_good&&(total_goods+=flt(t.facelec_p_gt_tax_net_goods_amt))}),e.doc.facelec_p_gt_tax_goods=total_goods),1==t.facelec_p_is_service&&(e.doc.items[o].facelec_p_gt_tax_net_services_amt=t.facelec_p_amount_minus_excise_tax/(1+a/100),e.doc.items[o].facelec_p_sales_tax_for_this_row=t.facelec_p_gt_tax_net_services_amt*(a/100),total_servi=0,$.each(e.doc.items||[],function(e,t){1==t.facelec_p_is_service&&(total_servi+=flt(t.facelec_p_gt_tax_net_services_amt))}),e.doc.facelec_p_gt_tax_services=total_servi),full_tax_iva=0,$.each(e.doc.items||[],function(e,t){full_tax_iva+=flt(t.facelec_p_sales_tax_for_this_row)}),e.doc.facelec_p_total_iva=full_tax_iva)})}function Q(e,t){return e*t}function F(e,t,_){e.doc.items.forEach(function(t){R(e,"Purchase Receipt Item",t.name)})}function R(e,t,_){cur_frm.refresh_fields();var a=cur_frm.doc.taxes[0].rate;e.doc.items.forEach(function(t,o){if(t.name==_){if(t.qty*t.rate,t.qty*t.conversion_factor,t.facelec_pr_tax_rate_per_uom,e.doc.items[o].facelec_pr_other_tax_amount=t.facelec_pr_tax_rate_per_uom*(t.qty*t.conversion_factor),e.doc.items[o].facelec_pr_amount_minus_excise_tax=t.qty*t.rate-t.qty*t.conversion_factor*t.facelec_pr_tax_rate_per_uom,t.facelec_pr_is_fuel){e.doc.items[o].facelec_pr_gt_tax_net_fuel_amt=t.facelec_pr_amount_minus_excise_tax/(1+a/100),e.doc.items[o].facelec_pr_sales_tax_for_this_row=t.facelec_pr_gt_tax_net_fuel_amt*(a/100);var c=0;$.each(e.doc.items||[],function(e,t){1==t.facelec_pr_is_fuel&&(c+=flt(t.facelec_pr_gt_tax_net_fuel_amt))}),e.doc.facelec_pr_gt_tax_fuel=c}if(t.facelec_pr_is_good){e.doc.items[o].facelec_pr_gt_tax_net_goods_amt=t.facelec_pr_amount_minus_excise_tax/(1+a/100),e.doc.items[o].facelec_pr_sales_tax_for_this_row=t.facelec_pr_gt_tax_net_goods_amt*(a/100);var s=0;$.each(e.doc.items||[],function(e,t){1==t.facelec_pr_is_good&&(s+=flt(t.facelec_pr_gt_tax_net_goods_amt))}),e.doc.facelec_pr_gt_tax_goods=s}if(t.facelec_pr_is_service){e.doc.items[o].facelec_pr_gt_tax_net_services_amt=t.facelec_pr_amount_minus_excise_tax/(1+a/100),e.doc.items[o].facelec_pr_sales_tax_for_this_row=t.facelec_pr_gt_tax_net_services_amt*(a/100);var i=0;$.each(e.doc.items||[],function(e,t){1==t.facelec_pr_is_service&&(i+=flt(t.facelec_pr_gt_tax_net_services_amt))}),e.doc.facelec_pr_gt_tax_services=i}var r=0;$.each(e.doc.items||[],function(e,t){r+=flt(t.facelec_pr_sales_tax_for_this_row)}),e.doc.facelec_pr_total_iva=r}})}function D(e,t){return e*t}function A(e,t,_){e.doc.items.forEach(function(t){C(e,"Purchase Order Item",t.name)})}function C(e,t,_){cur_frm.refresh_fields();var a=cur_frm.doc.taxes[0].rate;e.doc.items.forEach(function(t,o){if(t.name==_){if(t.qty*t.rate,t.qty*t.conversion_factor,t.facelec_po_tax_rate_per_uom,e.doc.items[o].facelec_po_other_tax_amount=t.facelec_po_tax_rate_per_uom*(t.qty*t.conversion_factor),e.doc.items[o].facelec_po_amount_minus_excise_tax=t.qty*t.rate-t.qty*t.conversion_factor*t.facelec_po_tax_rate_per_uom,t.facelec_po_is_fuel){e.doc.items[o].facelec_po_gt_tax_net_fuel_amt=t.facelec_po_amount_minus_excise_tax/(1+a/100),e.doc.items[o].facelec_po_sales_tax_for_this_row=t.facelec_po_gt_tax_net_fuel_amt*(a/100);var c=0;$.each(e.doc.items||[],function(e,t){1==t.facelec_po_is_fuel&&(c+=flt(t.facelec_po_gt_tax_net_fuel_amt))}),e.doc.facelec_po_gt_tax_fuel=c}if(t.facelec_po_is_good){e.doc.items[o].facelec_po_gt_tax_net_goods_amt=t.facelec_po_amount_minus_excise_tax/(1+a/100),e.doc.items[o].facelec_po_sales_tax_for_this_row=t.facelec_po_gt_tax_net_goods_amt*(a/100);var s=0;$.each(e.doc.items||[],function(e,t){1==t.facelec_po_is_good&&(s+=flt(t.facelec_po_gt_tax_net_goods_amt))}),e.doc.facelec_po_gt_tax_goods=s}if(t.facelec_po_is_service){e.doc.items[o].facelec_po_gt_tax_net_services_amt=t.facelec_po_amount_minus_excise_tax/(1+a/100),e.doc.items[o].facelec_po_sales_tax_for_this_row=t.facelec_po_gt_tax_net_services_amt*(a/100);var i=0;$.each(e.doc.items||[],function(e,t){1==t.facelec_po_is_service&&(i+=flt(t.facelec_po_gt_tax_net_services_amt))}),e.doc.facelec_po_gt_tax_services=i}var r=0;$.each(e.doc.items||[],function(e,t){r+=flt(t.facelec_po_sales_tax_for_this_row)}),e.doc.facelec_po_total_iva=r}})}function T(e,t,_){e.doc.items.forEach(function(t){G(e,"Supplier Quotation Item",t.name)})}function G(e,t,_){cur_frm.refresh_fields();var a=cur_frm.doc.taxes[0].rate;e.doc.items.forEach(function(t,o){if(t.name==_){if(t.qty*t.rate,t.qty*t.conversion_factor,t.shs_spq_tax_rate_per_uom,e.doc.items[o].shs_spq_other_tax_amount=t.shs_spq_tax_rate_per_uom*(t.qty*t.conversion_factor),e.doc.items[o].shs_spq_amount_minus_excise_tax=t.qty*t.rate-t.qty*t.conversion_factor*t.shs_spq_tax_rate_per_uom,t.shs_spq_is_fuel){e.doc.items[o].shs_spq_gt_tax_net_fuel_amt=t.shs_spq_amount_minus_excise_tax/(1+a/100),e.doc.items[o].shs_spq_sales_tax_for_this_row=t.shs_spq_gt_tax_net_fuel_amt*(a/100);var c=0;$.each(e.doc.items||[],function(e,t){1==t.shs_spq_is_fuel&&(c+=flt(t.shs_spq_gt_tax_net_fuel_amt))}),e.doc.shs_spq_gt_tax_fuel=c}if(t.shs_spq_is_good){e.doc.items[o].shs_spq_gt_tax_net_goods_amt=t.shs_spq_amount_minus_excise_tax/(1+a/100),e.doc.items[o].shs_spq_sales_tax_for_this_row=t.shs_spq_gt_tax_net_goods_amt*(a/100);var s=0;$.each(e.doc.items||[],function(e,t){1==t.shs_spq_is_good&&(s+=flt(t.shs_spq_gt_tax_net_goods_amt))}),e.doc.shs_spq_gt_tax_goods=s}if(t.shs_spq_is_service){e.doc.items[o].shs_spq_gt_tax_net_services_amt=t.shs_spq_amount_minus_excise_tax/(1+a/100),e.doc.items[o].shs_spq_sales_tax_for_this_row=t.shs_spq_gt_tax_net_services_amt*(a/100);var i=0;$.each(e.doc.items||[],function(e,t){1==t.shs_spq_is_service&&(i+=flt(t.shs_spq_gt_tax_net_services_amt))}),e.doc.shs_spq_gt_tax_services=i}var r=0;$.each(e.doc.items||[],function(e,t){r+=flt(t.shs_spq_sales_tax_for_this_row)}),e.doc.shs_spq_total_iva=r}})}return console.log("Se cargo exitosamente la aplicación de Factura Electrónica"),frappe.ui.form.on("Item",{facelec_is_fuel:function(e,t,_){e.doc.facelec_is_fuel&&(cur_frm.set_value("facelec_is_good",0),cur_frm.set_value("facelec_is_service",0))},facelec_is_good:function(e,t,_){e.doc.facelec_is_good&&(cur_frm.set_value("facelec_is_fuel",0),cur_frm.set_value("facelec_is_service",0))},facelec_is_service:function(e,t,_){e.doc.facelec_is_service&&(cur_frm.set_value("facelec_is_fuel",0),cur_frm.set_value("facelec_is_good",0))}}),frappe.ui.form.on("Sales Invoice",{onload_post_render:function(e,t,o){e.fields_dict.items.grid.wrapper.on("focusout blur",'input[data-fieldname="item_code"][data-doctype="Sales Invoice Item"]',function(t){a(e),_(e,0,o)}),e.fields_dict.items.grid.wrapper.on("click",'input[data-fieldname="uom"][data-doctype="Sales Invoice Item"]',function(t){a(e)}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="uom"][data-doctype="Sales Invoice Item"]',function(t){a(e)}),e.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="uom"][data-doctype="Sales Invoice Item"]',function(t){_(e,0,o)}),e.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="item_name"][data-doctype="Sales Invoice Item"]',function(t){a(e),i(e,0,o)}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Sales Invoice Item"]',function(t){a(e)}),e.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="qty"][data-doctype="Sales Invoice Item"]',function(t){a(e),_(e,0,o)}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Sales Invoice Item"]',function(t){a(e),cur_frm.refresh_field("conversion_factor")}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Sales Invoice Item"]',function(t){_(e,0,o),a(e),cur_frm.refresh_field("conversion_factor")}),e.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="rate"][data-doctype="Sales Invoice Item"]',function(e){}),cur_frm.fields_dict.customer.$input.on("keyup",function(t){_(e,0,o),a(e),refresh_field("qty")}),cur_frm.fields_dict.customer.$input.on("mouseleave blur focusout",function(t){_(e,0,o)}),cur_frm.fields_dict.taxes_and_charges.$input.on("focusout",function(t){_(e,0,o),i(e,0,o)})},customer:function(e,t,_){},refresh:function(e,t,a){cur_frm.add_fetch("customer","nit_face_customer","nit_face_customer"),e.add_custom_button("UOM Recalculation",function(){e.doc.items.forEach(function(t){_(e,0,t.name)})}),d("manual",e)},validate:function(e){!function(e){if(e.doc.items.length>0){var t=e.doc.items,_=Array.from(t);frappe.call({method:"factura_electronica.api.generar_tabla_html",args:{tabla:JSON.stringify(_)},callback:function(t){e.set_value("other_tax_facelec",t.message),e.refresh_field("other_tax_facelec")}})}}(e)},nit_face_customer:function(e,_,a){t(e.doc.nit_face_customer,e.doc.customer,e)},taxes_and_charges:function(e,t,_){},additional_discount_percentage:function(e,t,_){},discount_amount:function(e,t,_){e.doc.facelec_total_iva;var a=e.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100);if(NaN==a||null==a);else{var o=a*(cur_frm.doc.taxes[0].rate/100);e.doc.facelec_total_iva=e.doc.facelec_total_iva-o}},before_save:function(e,t,_){a(e),i(e,0,_)},on_submit:function(e,t,_){var a={};e.doc.shs_otros_impuestos.forEach(function(e,t){e.account_head&&(a[e.account_head]=e.total)}),Object.keys(a).length>0?frappe.call({method:"factura_electronica.special_tax.add_gl_entry_other_special_tax",args:{invoice_name:e.doc.name,accounts:a,invoice_type:"Sales Invoice"},callback:function(){e.reload_doc(),frappe.call({method:"factura_electronica.api.obtenerConfiguracionManualAutomatica",callback:function(t){t.message,"Automatico"===t.message&&d("automatico",e)}})}}):frappe.call({method:"factura_electronica.api.obtenerConfiguracionManualAutomatica",callback:function(t){t.message,"Automatico"===t.message&&d("automatico",e)}})},naming_series:function(e,t,_){frappe.call({method:"factura_electronica.api.obtener_numero_resolucion",args:{nombre_serie:e.doc.naming_series},callback:function(e){void 0===e.message?cur_frm.set_value("shs_numero_resolucion",""):cur_frm.set_value("shs_numero_resolucion",e.message)}})}}),frappe.ui.form.on("Sales Invoice Item",{items_add:function(e,t,_){},items_move:function(e,t,_){},before_items_remove:function(e,t,_){e.doc.items.forEach(function(t,a){t.name==_&&function(e,t,_,a){console.log("Otro Impuesto recibido es : "+a),e.doc.items.forEach(function(t,c){if(t.facelec_tax_rate_per_uom_account===_){var i=o(e,_)-a;e.doc.shs_otros_impuestos.forEach(function(t,a){t.account_head===_&&(cur_frm.doc.shs_otros_impuestos[a].total=i,cur_frm.refresh_field("shs_otros_impuestos"),s(e),cur_frm.refresh_field("shs_otros_impuestos"),t.total||(cur_frm.doc.shs_otros_impuestos.splice(cur_frm.doc.shs_otros_impuestos[a],1),cur_frm.refresh_field("shs_otros_impuestos")))})}})}(e,0,t.facelec_tax_rate_per_uom_account,t.facelec_other_tax_amount)})},items_remove:function(e,t,_){},item_code:function(e,t,_){a(e)},qty:function(e,t,a){_(e,0,a)},uom:function(e,t,_){},conversion_factor:function(e,t,a){_(e,0,a)},facelec_tax_rate_per_uom_account:function(e,t,_){},rate:function(e,t,a){_(e,0,a)},shs_amount_for_back_calc:function(e,t,_){e.doc.items.forEach(function(t,_){var a=t.rate,o=t.qty,c=(t.amount,goalSeek({Func:l,aFuncParams:[o,a],oFuncArgTarget:{Position:0},Goal:t.shs_amount_for_back_calc,Tol:.001,maxIter:1e4}));console.log(c),e.doc.items[_].qty=c,e.doc.items[_].amount=c*e.doc.items[_].rate,e.refresh_field("items")})}}),frappe.ui.form.on("Delivery Note",{onload_post_render:function(e,t,_){e.fields_dict.items.grid.wrapper.on("click focusout blur",'input[data-fieldname="item_code"][data-doctype="Delivery Note Item"]',function(t){p(e,0,_),m(e)}),e.fields_dict.items.grid.wrapper.on("click",'input[data-fieldname="uom"][data-doctype="Delivery Note Item"]',function(t){m(e)}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="uom"][data-doctype="Delivery Note Item"]',function(t){m(e)}),e.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="uom"][data-doctype="Delivery Note Item"]',function(t){p(e,0,_)}),e.fields_dict.items.grid.wrapper.on("focus",'input[data-fieldname="item_name"][data-doctype="Delivery Note Item"]',function(t){m(e)}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Delivery Note Item"]',function(t){m(e)}),e.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="qty"][data-doctype="Delivery Note Item"]',function(t){m(e),p(e,0,_)}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Delivery Note Item"]',function(t){m(e),cur_frm.refresh_field("conversion_factor")}),e.fields_dict.items.grid.wrapper.on("keyup mouseleave focusout",'input[data-fieldname="conversion_factor"][data-doctype="Delivery Note Item"]',function(t){p(e,0,_),m(e),cur_frm.refresh_field("conversion_factor")}),cur_frm.fields_dict.customer.$input.on("mouseleave blur focusout",function(t){p(e,0,_)}),cur_frm.fields_dict.items.$wrapper.on("click",function(t){m(e)}),cur_frm.fields_dict.taxes_and_charges.$input.on("focusout",function(t){p(e,0,_)})},shs_dn_nit:function(e){t(e.doc.shs_dn_nit,e.doc.customer,e)},discount_amount:function(e){e.doc.shs_dn_total_iva;var t=e.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100);NaN==t||null==t||(discount_amount_tax_value=t*(cur_frm.doc.taxes[0].rate/100),e.doc.shs_dn_total_iva=e.doc.shs_dn_total_iva-discount_amount_tax_value)},before_save:function(e,t,_){m(e)}}),frappe.ui.form.on("Delivery Note Item",{items_remove:function(e){var t=0,_=0,a=0,o=0;$.each(e.doc.items||[],function(e,c){t+=flt(c.shs_dn_gt_tax_net_fuel_amt),_+=flt(c.shs_dn_gt_tax_net_goods_amt),a+=flt(c.shs_dn_gt_tax_net_services_amt),o+=flt(c.shs_dn_sales_tax_for_this_row)}),cur_frm.set_value("shs_dn_gt_tax_fuel",t),cur_frm.set_value("shs_dn_gt_tax_goods",_),cur_frm.set_value("shs_dn_gt_tax_services",a),cur_frm.set_value("shs_dn_total_iva",o)},item_code:function(e,t,_){refresh_field("qty")},qty:function(e,t,_){p(e,0,_)},conversion_factor:function(e,t,_){p(e,0,_)},rate:function(e,t,_){p(e,0,_)},shs_amount_for_back_calc:function(e,t,_){e.doc.items.forEach(function(t,_){var a=t.rate,o=t.qty,c=(t.amount,goalSeek({Func:h,aFuncParams:[o,a],oFuncArgTarget:{Position:0},Goal:t.shs_amount_for_back_calc,Tol:.001,maxIter:1e4}));console.log(c),e.doc.items[_].qty=c,e.doc.items[_].amount=c*e.doc.items[_].rate,e.refresh_field("items")})}}),frappe.ui.form.on("Sales Order",{onload_post_render:function(e,t,_){e.fields_dict.items.grid.wrapper.on("click focusout blur",'input[data-fieldname="item_code"][data-doctype="Sales Order Item"]',function(t){x(e,0,_),v(e)}),e.fields_dict.items.grid.wrapper.on("click",'input[data-fieldname="uom"][data-doctype="Sales Order Item"]',function(t){v(e)}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="uom"][data-doctype="Sales Order Item"]',function(t){v(e)}),e.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="uom"][data-doctype="Sales Order Item"]',function(t){x(e,0,_)}),e.fields_dict.items.grid.wrapper.on("focus",'input[data-fieldname="item_name"][data-doctype="Sales Order Item"]',function(t){v(e)}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Sales Order Item"]',function(t){v(e)}),e.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="qty"][data-doctype="Sales Order Item"]',function(t){v(e),x(e,0,_)}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Sales Order Item"]',function(t){v(e),cur_frm.refresh_field("conversion_factor")}),e.fields_dict.items.grid.wrapper.on("keyup mouseleave focusout",'input[data-fieldname="conversion_factor"][data-doctype="Sales Order Item"]',function(t){x(e,0,_),v(e),cur_frm.refresh_field("conversion_factor")}),cur_frm.fields_dict.customer.$input.on("keyup",function(e){}),cur_frm.fields_dict.customer.$input.on("mouseleave blur focusout",function(t){x(e,0,_)}),cur_frm.fields_dict.items.$wrapper.on("click",function(t){v(e)}),cur_frm.fields_dict.taxes_and_charges.$input.on("focusout",function(t){x(e,0,_)})},shs_so_nit:function(e){t(e.doc.shs_so_nit,e.doc.customer,e)},discount_amount:function(e){e.doc.shs_so_total_iva;var t=e.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100);NaN==t||null==t||(discount_amount_tax_value=t*(cur_frm.doc.taxes[0].rate/100),e.doc.shs_so_total_iva=e.doc.shs_so_total_iva-discount_amount_tax_value)},before_save:function(e,t,_){v(e)}}),frappe.ui.form.on("Sales Order Item",{items_remove:function(e){var t=0,_=0,a=0,o=0;$.each(e.doc.items||[],function(e,c){t+=flt(c.shs_so_gt_tax_net_fuel_amt),_+=flt(c.shs_so_gt_tax_net_goods_amt),a+=flt(c.shs_so_gt_tax_net_services_amt),o+=flt(c.shs_so_sales_tax_for_this_row)}),cur_frm.set_value("shs_gt_tax_fuel",t),cur_frm.set_value("shs_so_gt_tax_goods",_),cur_frm.set_value("shs_so_gt_tax_services",a),cur_frm.set_value("shs_so_total_iva",o)},item_code:function(e,t,_){cur_frm.doc.taxes[0].rate;refresh_field("qty")},qty:function(e,t,_){x(e,0,_)},conversion_factor:function(e,t,_){x(e,0,_)},rate:function(e,t,_){x(e,0,_)}}),frappe.ui.form.on("Quotation",{onload_post_render:function(e,t,_){e.fields_dict.items.grid.wrapper.on("click focusout blur",'input[data-fieldname="item_code"][data-doctype="Quotation Item"]',function(t){b(e,0,_),g(e)}),e.fields_dict.items.grid.wrapper.on("click",'input[data-fieldname="uom"][data-doctype="Quotation Item"]',function(t){g(e)}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="uom"][data-doctype="Quotation Item"]',function(t){g(e)}),e.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="uom"][data-doctype="Quotation Item"]',function(t){b(e,0,_)}),e.fields_dict.items.grid.wrapper.on("focus",'input[data-fieldname="item_name"][data-doctype="Quotation Item"]',function(t){g(e),I(e,0,_)}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Quotation Item"]',function(t){g(e)}),e.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="qty"][data-doctype="Quotation Item"]',function(t){g(e),b(e,0,_)}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Quotation Item"]',function(t){g(e),cur_frm.refresh_field("conversion_factor")}),e.fields_dict.items.grid.wrapper.on("keyup mouseleave focusout",'input[data-fieldname="conversion_factor"][data-doctype="Quotation Item"]',function(t){b(e,0,_),g(e),cur_frm.refresh_field("conversion_factor")}),cur_frm.fields_dict.customer.$input.on("keyup",function(e){}),cur_frm.fields_dict.customer.$input.on("mouseleave blur focusout",function(t){b(e,0,_)}),cur_frm.fields_dict.items.$wrapper.on("click",function(t){g(e)}),cur_frm.fields_dict.taxes_and_charges.$input.on("focusout",function(t){b(e,0,_),I(e,0,_)})},facelec_qt_nit:function(e,_,a){t(e.doc.facelec_qt_nit,e.doc.customer,e)},discount_amount:function(e,t,_){e.doc.facelec_total_iva;var a=e.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100);NaN==a||null==a||(discount_amount_tax_value=a*(cur_frm.doc.taxes[0].rate/100),e.doc.facelec_total_iva=e.doc.facelec_total_iva-discount_amount_tax_value)},before_save:function(e,t,_){g(e),I(e,0,_)}}),frappe.ui.form.on("Quotation Item",{before_items_remove:function(e,t,_){e.doc.items.forEach(function(t,a){t.name==_&&function(e,t,_){e.doc.items.forEach(function(a,o){if(a.facelec_qt_tax_rate_per_uom_account===t){var c=q(e,t)-_;e.doc.shs_tax_quotation.forEach(function(_,a){_.account_head===t&&(cur_frm.doc.shs_tax_quotation[a].total=c,cur_frm.refresh_field("shs_tax_quotation"),w(e),cur_frm.refresh_field("shs_tax_quotation"),0===_.total&&(cur_frm.doc.shs_tax_quotation.splice(cur_frm.doc.shs_tax_quotation[a],1),cur_frm.refresh_field("shs_tax_quotation")))})}})}(e,t.facelec_qt_tax_rate_per_uom_account,t.facelec_qt_other_tax_amount)})},items_remove:function(e,t,_){var a=0,o=0,c=0,s=0;$.each(e.doc.items||[],function(e,t){a+=flt(t.facelec_qt_gt_tax_net_fuel_amt),o+=flt(t.facelec_qt_gt_tax_net_goods_amt),c+=flt(t.facelec_qt_gt_tax_net_services_amt),s+=flt(t.facelec_qt_sales_tax_for_this_row)}),cur_frm.set_value("facelec_qt_gt_tax_fuel",a),cur_frm.set_value("facelec_qt_gt_tax_goods",o),cur_frm.set_value("facelec_qt_gt_tax_services",c),cur_frm.set_value("facelec_qt_total_iva",s)},item_code:function(e,t,_){cur_frm.doc.taxes[0].rate;refresh_field("qty")},qty:function(e,t,_){b(e,0,_)},uom:function(e,t,_){},conversion_factor:function(e,t,_){b(e,0,_)},rate:function(e,t,_){b(e,0,_)}}),frappe.ui.form.on("Purchase Invoice",{onload_post_render:function(e,t,_){e.fields_dict.items.grid.wrapper.on("click focusout blur",'input[data-fieldname="item_code"][data-doctype="Purchase Invoice Item"]',function(t){O(e,0,_),k(e)}),e.fields_dict.items.grid.wrapper.on("click",'input[data-fieldname="uom"][data-doctype="Purchase Invoice Item"]',function(t){k(e)}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="uom"][data-doctype="Purchase Invoice Item"]',function(t){k(e)}),e.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="uom"][data-doctype="Purchase Invoice Item"]',function(t){O(e,0,_)}),e.fields_dict.items.grid.wrapper.on("focus",'input[data-fieldname="item_name"][data-doctype="Purchase Invoice Item"]',function(t){k(e),N(e,0,_)}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Purchase Invoice Item"]',function(t){k(e)}),e.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="qty"][data-doctype="Purchase Invoice Item"]',function(t){k(e),O(e,0,_)}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Purchase Invoice Item"]',function(t){k(e),cur_frm.refresh_field("conversion_factor")}),e.fields_dict.items.grid.wrapper.on("keyup mouseleave focusout",'input[data-fieldname="conversion_factor"][data-doctype="Purchase Invoice Item"]',function(t){O(e,0,_),k(e),cur_frm.refresh_field("conversion_factor")}),cur_frm.fields_dict.supplier.$input.on("keyup",function(e){}),cur_frm.fields_dict.supplier.$input.on("mouseleave blur focusout",function(t){O(e,0,_)}),cur_frm.fields_dict.items.$wrapper.on("click",function(t){k(e)}),cur_frm.fields_dict.taxes_and_charges.$input.on("focusout",function(t){O(e,0,_),N(e,0,_)})},facelec_nit_fproveedor:function(e,t,_){valNit(e.doc.facelec_nit_fproveedor,e.doc.supplier,e)},discount_amount:function(e,t,_){tax_before_calc=e.doc.facelec_total_iva,discount_amount_net_value=e.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100),NaN==discount_amount_net_value||null==discount_amount_net_value||(discount_amount_tax_value=discount_amount_net_value*(cur_frm.doc.taxes[0].rate/100),e.doc.facelec_total_iva=e.doc.facelec_total_iva-discount_amount_tax_value)},before_save:function(e,t,_){k(e),N(e,0,_)},validate:function(e){!function(e){if(e.doc.items.length>0){var t=e.doc.items,_=Array.from(t);frappe.call({method:"factura_electronica.api.generar_tabla_html_factura_compra",args:{tabla:JSON.stringify(_)},callback:function(t){e.set_value("other_tax_facelec",t.message),e.refresh_field("other_tax_facelec")}})}}(e)},on_submit:function(e,t,_){var a={};e.doc.shs_pi_otros_impuestos.forEach(function(e,t){e.account_head&&(a[e.account_head]=e.total)}),Object.keys(a).length>0&&frappe.call({method:"factura_electronica.special_tax.add_gl_entry_other_special_tax",args:{invoice_name:e.doc.name,accounts:a,invoice_type:"Purchase Invoice"},callback:function(){}})},naming_series:function(e,t,_){console.log(e.doc.naming_series),frappe.call({method:"factura_electronica.special_invoice.verificar_existencia_series",args:{serie:e.doc.naming_series},callback:function(t){console.log(t.message),"fail"!=t.message&&(cur_frm.clear_table("taxes"),cur_frm.refresh_fields(),e.set_value("taxes_and_charges",t.message[2]),e.refresh_field("taxes_and_charges"))}})}}),frappe.ui.form.on("Purchase Invoice Item",{before_items_remove:function(e,t,_){e.doc.items.forEach(function(t,a){t.name==_&&function(e,t,_){e.doc.items.forEach(function(a,o){if(a.facelec_p_tax_rate_per_uom_account===t){var c=E(e,t)-_;e.doc.shs_pi_otros_impuestos.forEach(function(_,a){_.account_head===t&&(cur_frm.doc.shs_pi_otros_impuestos[a].total=c,cur_frm.refresh_field("shs_pi_otros_impuestos"),S(e),cur_frm.refresh_field("shs_pi_otros_impuestos"),_.total||(cur_frm.doc.shs_pi_otros_impuestos.splice(cur_frm.doc.shs_pi_otros_impuestos[a],1),cur_frm.refresh_field("shs_pi_otros_impuestos")))})}})}(e,t.facelec_p_tax_rate_per_uom_account,t.facelec_p_other_tax_amount)})},items_remove:function(e,t,_){fix_gt_tax_fuel=0,fix_gt_tax_goods=0,fix_gt_tax_services=0,fix_gt_tax_iva=0,$.each(e.doc.items||[],function(e,t){fix_gt_tax_fuel+=flt(t.facelec_p_gt_tax_net_fuel_amt),fix_gt_tax_goods+=flt(t.facelec_p_gt_tax_net_goods_amt),fix_gt_tax_services+=flt(t.facelec_p_gt_tax_net_services_amt),fix_gt_tax_iva+=flt(t.facelec_p_sales_tax_for_this_row)}),cur_frm.set_value("facelec_p_gt_tax_fuel",fix_gt_tax_fuel),cur_frm.set_value("facelec_p_gt_tax_goods",fix_gt_tax_goods),cur_frm.set_value("facelec_p_gt_tax_services",fix_gt_tax_services),cur_frm.set_value("facelec_p_total_iva",fix_gt_tax_iva)},item_code:function(e,t,_){this_company_sales_tax_var=cur_frm.doc.taxes[0].rate,refresh_field("qty")},qty:function(e,t,_){O(e,0,_)},uom:function(e,t,_){},conversion_factor:function(e,t,_){O(e,0,_)},rate:function(e,t,_){O(e,0,_)},shs_amount_for_back_calc:function(e,t,_){e.doc.items.forEach(function(t,a){console.log(t.rate),console.log(t.qty),console.log(t.amount);var o=t.rate,c=t.qty,s=(t.amount,goalSeek({Func:Q,aFuncParams:[c,o],oFuncArgTarget:{Position:0},Goal:t.shs_amount_for_back_calc,Tol:.001,maxIter:1e4}));console.log(s),e.doc.items[a].qty=s,e.doc.items[a].amount=s*e.doc.items[a].rate,e.refresh_field("items"),k(e),N(e,0,_)})}}),frappe.ui.form.on("Purchase Receipt",{onload_post_render:function(e,t,_){e.fields_dict.items.grid.wrapper.on("click focusout blur",'input[data-fieldname="item_code"][data-doctype="Purchase Receipt Item"]',function(t){R(e,0,_),F(e)}),e.fields_dict.items.grid.wrapper.on("click",'input[data-fieldname="uom"][data-doctype="Purchase Receipt Item"]',function(t){F(e)}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="uom"][data-doctype="Purchase Receipt Item"]',function(t){F(e)}),e.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="uom"][data-doctype="Purchase Receipt Item"]',function(t){R(e,0,_)}),e.fields_dict.items.grid.wrapper.on("focus",'input[data-fieldname="item_name"][data-doctype="Purchase Receipt Item"]',function(t){F(e)}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Purchase Receipt Item"]',function(t){F(e)}),e.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="qty"][data-doctype="Purchase Receipt Item"]',function(t){F(e),R(e,0,_)}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Purchase Receipt Item"]',function(t){F(e),cur_frm.refresh_field("conversion_factor")}),e.fields_dict.items.grid.wrapper.on("keyup mouseleave focusout",'input[data-fieldname="conversion_factor"][data-doctype="Purchase Receipt Item"]',function(t){R(e,0,_),F(e),cur_frm.refresh_field("conversion_factor")}),cur_frm.fields_dict.supplier.$input.on("keyup",function(e){}),cur_frm.fields_dict.supplier.$input.on("mouseleave blur focusout",function(t){R(e,0,_)}),cur_frm.fields_dict.items.$wrapper.on("click",function(t){F(e)}),cur_frm.fields_dict.taxes_and_charges.$input.on("focusout",function(t){R(e,0,_)})},facelec_nit_prproveedor:function(e){t(e.doc.facelec_nit_prproveedor,e.doc.supplier,e)},discount_amount:function(e){e.doc.facelec_pr_total_iva;var t=e.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100);NaN==t||null==t||(discount_amount_tax_value=t*(cur_frm.doc.taxes[0].rate/100),e.doc.facelec_pr_total_iva=e.doc.facelec_pr_total_iva-discount_amount_tax_value)},before_save:function(e,t,_){F(e)}}),frappe.ui.form.on("Purchase Receipt Item",{items_remove:function(e){var t=0,_=0,a=0,o=0;$.each(e.doc.items||[],function(e,c){t+=flt(c.facelec_pr_gt_tax_net_fuel_amt),_+=flt(c.facelec_pr_gt_tax_net_goods_amt),a+=flt(c.facelec_pr_gt_tax_net_services_amt),o+=flt(c.facelec_pr_sales_tax_for_this_row)}),cur_frm.set_value("facelec_pr_gt_tax_fuel",t),cur_frm.set_value("facelec_pr_gt_tax_goods",_),cur_frm.set_value("facelec_pr_gt_tax_services",a),cur_frm.set_value("facelec_pr_total_iva",o)},item_code:function(e,t,_){cur_frm.doc.taxes[0].rate;refresh_field("qty")},qty:function(e,t,_){R(e,0,_)},conversion_factor:function(e,t,_){R(e,0,_)},rate:function(e,t,_){R(e,0,_)},shs_amount_for_back_calc:function(e,t,_){e.doc.items.forEach(function(t,_){var a=t.rate,o=t.qty,c=(t.amount,goalSeek({Func:D,aFuncParams:[o,a],oFuncArgTarget:{Position:0},Goal:t.shs_amount_for_back_calc,Tol:.001,maxIter:1e4}));console.log(c),e.doc.items[_].qty=c,e.doc.items[_].amount=c*e.doc.items[_].rate,e.refresh_field("items")})}}),frappe.ui.form.on("Purchase Order",{onload_post_render:function(e,t,_){e.fields_dict.items.grid.wrapper.on("click focusout blur",'input[data-fieldname="item_code"][data-doctype="Purchase Order Item"]',function(t){C(e,0,_),A(e)}),e.fields_dict.items.grid.wrapper.on("click",'input[data-fieldname="uom"][data-doctype="Purchase Order Item"]',function(t){A(e)}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="uom"][data-doctype="Purchase Order Item"]',function(t){A(e)}),e.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="uom"][data-doctype="Purchase Order Item"]',function(t){C(e,0,_)}),e.fields_dict.items.grid.wrapper.on("focus",'input[data-fieldname="item_name"][data-doctype="Purchase Order Item"]',function(t){A(e)}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Purchase Order Item"]',function(t){A(e)}),e.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="qty"][data-doctype="Purchase Order Item"]',function(t){A(e),C(e,0,_)}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Purchase Order Item"]',function(t){A(e),cur_frm.refresh_field("conversion_factor")}),e.fields_dict.items.grid.wrapper.on("keyup mouseleave focusout",'input[data-fieldname="conversion_factor"][data-doctype="Purchase Order Item"]',function(t){C(e,0,_),A(e),cur_frm.refresh_field("conversion_factor")}),cur_frm.fields_dict.supplier.$input.on("keyup",function(e){}),cur_frm.fields_dict.supplier.$input.on("mouseleave blur focusout",function(t){C(e,0,_)}),cur_frm.fields_dict.items.$wrapper.on("click",function(t){A(e)}),cur_frm.fields_dict.taxes_and_charges.$input.on("focusout",function(t){C(e,0,_)})},facelec_po_nit:function(e){t(e.doc.facelec_po_nit,e.doc.supplier,e)},discount_amount:function(e){e.doc.facelec_po_total_iva;var t=e.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100);NaN==t||null==t||(discount_amount_tax_value=t*(cur_frm.doc.taxes[0].rate/100),e.doc.facelec_po_total_iva=e.doc.facelec_po_total_iva-discount_amount_tax_value)},before_save:function(e,t,_){A(e)}}),frappe.ui.form.on("Purchase Order Item",{items_remove:function(e){var t=0,_=0,a=0,o=0;$.each(e.doc.items||[],function(e,c){t+=flt(c.facelec_po_gt_tax_net_fuel_amt),_+=flt(c.facelec_po_gt_tax_net_goods_amt),a+=flt(c.facelec_po_gt_tax_net_services_amt),o+=flt(c.facelec_po_sales_tax_for_this_row)}),cur_frm.set_value("facelec_po_gt_tax_fuel",t),cur_frm.set_value("facelec_po_gt_tax_goods",_),cur_frm.set_value("facelec_po_gt_tax_services",a),cur_frm.set_value("facelec_po_total_iva",o)},item_code:function(e,t,_){cur_frm.doc.taxes[0].rate;refresh_field("qty")},qty:function(e,t,_){C(e,0,_)},conversion_factor:function(e,t,_){C(e,0,_)},rate:function(e,t,_){C(e,0,_)}}),frappe.ui.form.on("Supplier Quotation",{onload_post_render:function(e,t,_){e.fields_dict.items.grid.wrapper.on("click focusout blur",'input[data-fieldname="item_code"][data-doctype="Supplier Quotation Item"]',function(t){G(e,0,_),T(e)}),e.fields_dict.items.grid.wrapper.on("click",'input[data-fieldname="uom"][data-doctype="Supplier Quotation Item"]',function(t){T(e)}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="uom"][data-doctype="Supplier Quotation Item"]',function(t){T(e)}),e.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="uom"][data-doctype="Supplier Quotation Item"]',function(t){G(e,0,_)}),e.fields_dict.items.grid.wrapper.on("focus",'input[data-fieldname="item_name"][data-doctype="Supplier Quotation Item"]',function(t){T(e)}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Supplier Quotation Item"]',function(t){T(e)}),e.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="qty"][data-doctype="Supplier Quotation Item"]',function(t){T(e),G(e,0,_)}),e.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Supplier Quotation Item"]',function(t){T(e),cur_frm.refresh_field("conversion_factor")}),e.fields_dict.items.grid.wrapper.on("keyup mouseleave focusout",'input[data-fieldname="conversion_factor"][data-doctype="Supplier Quotation Item"]',function(t){G(e,0,_),T(e),cur_frm.refresh_field("conversion_factor")}),cur_frm.fields_dict.supplier.$input.on("keyup",function(e){}),cur_frm.fields_dict.supplier.$input.on("mouseleave blur focusout",function(t){G(e,0,_)}),cur_frm.fields_dict.items.$wrapper.on("click",function(t){T(e)}),cur_frm.fields_dict.taxes_and_charges.$input.on("focusout",function(t){G(e,0,_)})},shs_spq_nit:function(e){t(e.doc.shs_spq_nit,e.doc.supplier,e)},discount_amount:function(e){e.doc.shs_spq_total_iva;var t=e.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100);NaN==t||null==t||(discount_amount_tax_value=t*(cur_frm.doc.taxes[0].rate/100),e.doc.shs_spq_total_iva=e.doc.shs_spq_total_iva-discount_amount_tax_value)},before_save:function(e,t,_){T(e)}}),frappe.ui.form.on("Supplier Quotation Item",{items_remove:function(e,t,_){var a=0,o=0,c=0,s=0;$.each(e.doc.items||[],function(e,t){a+=flt(t.shs_spq_gt_tax_net_fuel_amt),o+=flt(t.shs_spq_gt_tax_net_goods_amt),c+=flt(t.shs_spq_gt_tax_net_services_amt),s+=flt(t.shs_spq_sales_tax_for_this_row)}),cur_frm.set_value("shs_spq_gt_tax_fuel",a),cur_frm.set_value("shs_spq_gt_tax_goods",o),cur_frm.set_value("shs_spq_gt_tax_services",c),cur_frm.set_value("shs_spq_total_iva",s)},item_code:function(e,t,_){cur_frm.doc.taxes[0].rate;refresh_field("qty")},qty:function(e,t,_){G(e,0,_)},conversion_factor:function(e,t,_){G(e,0,_)},rate:function(e,t,_){G(e,0,_)}}),e.valNit=t,e}({});
//# sourceMappingURL=facelec.min.js.map
