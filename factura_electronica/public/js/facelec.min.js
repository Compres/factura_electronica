var Rollup=function(t){"use strict";function e(t,e,_){var a;if("C/F"===t||"c/f"===t)_.enable_save();else{var o,c=0;if(o=/^(\d+)\-?([\dk])$/i.exec(t)){o[2]="k"==o[2].toLowerCase()?10:parseInt(o[2]);for(var r=0;r<o[1].length;r++)c+=(-1*(r-o[1].length)+1)*o[1][r];a=(11-c%11)%11==o[2]}else a=!1;!1===a&&(frappe.show_alert({indicator:"orange",message:__("\n\t\t\t\tNIT de <a href= '#Form/Customer/"+e+"'><b>"+e+"</b></a> no es correcto. Si no tiene disponible el NIT modifiquelo a C/F.\n\t\t\t\t")}),_.disable_save()),!0===a&&_.enable_save()}}function _(t){var e,_,c;if(t.Tol=t.Tol||.001*t.Goal||.1,t.maxIter=t.maxIter||1e3,t.oFuncArgTarget.propStr){if(!t.aFuncParams[t.oFuncArgTarget.Position][t.oFuncArgTarget.propStr])for(var r=0;r<100;r++){var s=Math.random();if(a(t.aFuncParams[t.oFuncArgTarget.Position],t.oFuncArgTarget.propStr,s),t.Func.apply(t.This,t.aFuncParams))break;if(99===r)return null}for(r=0;r<t.maxIter;r++){if(_=t.Func.apply(t.This,t.aFuncParams)-t.Goal,Math.abs(_)<=t.Tol)return o(t.aFuncParams[t.oFuncArgTarget.Position],t.oFuncArgTarget.propStr);c=o(t.aFuncParams[t.oFuncArgTarget.Position],t.oFuncArgTarget.propStr),a(t.aFuncParams[t.oFuncArgTarget.Position],t.oFuncArgTarget.propStr,c+_),0===(e=(t.Func.apply(t.This,t.aFuncParams)-t.Goal-_)/_)&&(e=1e-4),a(t.aFuncParams[t.oFuncArgTarget.Position],t.oFuncArgTarget.propStr,c-_/e)}if(Math.abs(_)>t.Tol)return null}else{if(!t.aFuncParams[t.oFuncArgTarget.Position])for(r=0;r<100;r++){s=Math.random();if(t.aFuncParams[t.oFuncArgTarget.Position]=s,t.Func.apply(t.This,t.aFuncParams))break;if(99===r)return null}for(r=0;r<t.maxIter;r++){if(_=t.Func.apply(t.This,t.aFuncParams)-t.Goal,Math.abs(_)<=t.Tol)return t.aFuncParams[t.oFuncArgTarget.Position];c=t.aFuncParams[t.oFuncArgTarget.Position],t.aFuncParams[t.oFuncArgTarget.Position]=c+_,0===(e=(t.Func.apply(t.This,t.aFuncParams)-t.Goal-_)/_)&&(e=1e-4),t.aFuncParams[t.oFuncArgTarget.Position]=c-_/e}if(Math.abs(_)>t.Tol)return null}}function a(t,e,_){for(var a=t,o=e.split("."),c=o.length,r=0;r<c-1;r++){var s=o[r];a[s]||(a[s]={}),a=a[s]}a[o[c-1]]=_}function o(t,e){for(var _=e.split("."),a=t,o=0;o<_.length;o++)a=a[_[o]];return a}function c(t,e,_){var a;"undefined"!==cur_frm.doc.taxes[0].rate&&(a=cur_frm.doc.taxes[0].rate);t.doc.items.forEach(function(e,o){if(e.name===_){e.amount,e.stock_qty,e.facelec_tax_rate_per_uom,e.stock_qty*e.facelec_tax_rate_per_uom,e.amount-e.stock_qty*e.facelec_tax_rate_per_uom,t.doc.items[o].facelec_other_tax_amount=e.facelec_tax_rate_per_uom*(e.qty*e.conversion_factor),t.doc.items[o].facelec_amount_minus_excise_tax=e.qty*e.rate-e.stock_qty*e.facelec_tax_rate_per_uom,t.refresh_field("items"),t.refresh_field("conversion_factor"),e.factelecis_fuel&&(t.doc.items[o].facelec_gt_tax_net_fuel_amt=e.facelec_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_sales_tax_for_this_row=e.facelec_gt_tax_net_fuel_amt*(a/100)),e.facelec_is_good&&(t.doc.items[o].facelec_gt_tax_net_goods_amt=e.facelec_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_sales_tax_for_this_row=e.facelec_gt_tax_net_goods_amt*(a/100)),e.facelec_is_service&&(t.doc.items[o].facelec_gt_tax_net_services_amt=e.facelec_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_sales_tax_for_this_row=e.facelec_gt_tax_net_services_amt*(a/100));var c=0;$.each(t.doc.items||[],function(t,e){e.facelec_sales_tax_for_this_row&&(c+=flt(e.facelec_sales_tax_for_this_row))}),cur_frm.set_value("shs_total_iva_fac",c)}})}function r(t,e,_){t.doc.items.forEach(function(e){t.doc.facelec_total_iva;var _=t.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100);if("NaN"==typeof cur_frm.doc.taxes[0].rate);else{var a=_*(cur_frm.doc.taxes[0].rate/100);t.doc.facelec_total_iva=t.doc.facelec_total_iva-a}c(t,0,e.name),f(t,"Sales Invoice Item",e.name)})}function s(t,e){var _=0;return $.each(t.doc.items||[],function(t,a){a.facelec_tax_rate_per_uom_account===e&&(_+=flt(a.facelec_other_tax_amount))}),_}function i(t,e,_){t.doc.items.forEach(function(e,a){e.name===_&&e.facelec_tax_rate_per_uom_account&&void 0!==t.doc.shs_otros_impuestos&&t.doc.shs_otros_impuestos.forEach(function(_,a){if(_.account_head===e.facelec_tax_rate_per_uom_account){var o;o=s(t,_.account_head),cur_frm.doc.shs_otros_impuestos[a].total=o,n(t)}})})}function n(t){var e=0;$.each(t.doc.shs_otros_impuestos||[],function(t,_){_.account_head&&(e+=flt(_.total))}),cur_frm.set_value("shs_total_otros_imp_incl",e),t.refresh_field("shs_total_otros_imp_incl")}function f(t,e,_){var a=0;t.doc.items.forEach(function(e,o){if(e.name===_){e.stock_qty*e.facelec_tax_rate_per_uom,a=e.facelec_other_tax_amount;var c=e.facelec_tax_rate_per_uom_account;t.refresh_field("items"),t.refresh_field("conversion_factor"),c&&(!function(t,e){var _=!1;return $.each(t.doc.shs_otros_impuestos||[],function(t,a){a.account_head===e&&(_=!0)}),_}(t,c)?(frappe.model.add_child(cur_frm.doc,"Otros Impuestos Factura Electronica","shs_otros_impuestos"),cur_frm.refresh_field("items"),t.doc.shs_otros_impuestos.forEach(function(e,o){void 0===e.account_head&&(cur_frm.doc.shs_otros_impuestos[o].account_head=c,cur_frm.doc.shs_otros_impuestos[o].total=a,cur_frm.refresh_field("shs_otros_impuestos"),i(t,0,_),cur_frm.refresh_field("shs_otros_impuestos"))})):(i(t,0,_),cur_frm.refresh_field("shs_otros_impuestos")))}})}function u(t,e){e.add_custom_button(__("VER PDF FACTURA ELECTRONICA"),function(){window.open("https://www.ingface.net/Ingfacereport/dtefactura.jsp?cae="+t)}).addClass("btn-primary")}function d(t){t.add_custom_button(__("GUARDAR PDF"),function(){frappe.call({method:"factura_electronica.api.guardar_pdf_servidor",args:{nombre_archivo:t.doc.name,cae_de_factura_electronica:t.doc.cae_factura_electronica},callback:function(){t.reload_doc()}})}).addClass("btn-primary")}function l(t,e){e.add_custom_button(__(t),function(){e.reload_doc();var t=e.doc.name,_=window.location.href;frappe.call({method:"factura_electronica.api.generar_factura_electronica",args:{serie_factura:e.doc.name,nombre_cliente:e.doc.customer,pre_se:e.doc.naming_series},callback:function(a){if(void 0!==a.message){var o=_.replace(t,a.message);window.location.assign(o),e.reload_doc()}}})}).addClass("btn-primary")}function m(t){t.reload_doc();var e=t.doc.name,_=window.location.href;frappe.call({method:"factura_electronica.api.generar_factura_electronica",args:{serie_factura:t.doc.name,nombre_cliente:t.doc.customer,pre_se:t.doc.naming_series},callback:function(a){if(void 0!==a.message){var o=_.replace(e,a.message);window.location.assign(o),t.reload_doc()}else t.reload_doc()}})}function p(t,e,_,a){"Paid"!==e.doc.status&&"Unpaid"!==e.doc.status&&"Submitted"!==e.doc.status&&"Overdue"!==e.doc.status||(e.doc.cae_factura_electronica?(cur_frm.clear_custom_buttons(),u(e.doc.cae_factura_electronica,e),d(e)):("manual"===t&&l("Factura Electronica",e),"automatico"===t&&m(e))),"Return"===e.doc.status&&(e.doc.cae_factura_electronica?(cur_frm.clear_custom_buttons(),u(e.doc.cae_factura_electronica,e),d(e)):("manual"===t&&l("Nota Credito Electronica",e),"automatico"===t&&m(e))),"Paid"!==e.doc.status&&"Unpaid"!==e.doc.status&&"Submitted"!==e.doc.status&&"Overdue"!==e.doc.status||e.doc.es_nota_de_debito&&(cur_frm.clear_custom_buttons("Factura Electronica"),e.doc.cae_factura_electronica?(cur_frm.clear_custom_buttons(),u(e.doc.cae_factura_electronica,e),d(e)):("manual"===t&&l("Nota Debito Electronica",e),"automatico"===t&&m(e))),"Draft"===e.doc.status&&(cur_frm.set_value("cae_factura_electronica",""),cur_frm.set_value("serie_original_del_documento",""))}function h(t,e){return t*e}function v(t,e,_){t.doc.items.forEach(function(e){x(t,"Delivery Note Item",e.name)})}function x(t,e,_){cur_frm.refresh_fields();var a=cur_frm.doc.taxes[0].rate;t.doc.items.forEach(function(e,o){if(e.name==_){if(e.qty*e.rate,e.qty*e.conversion_factor,e.shs_dn_tax_rate_per_uom,t.doc.items[o].shs_dn_other_tax_amount=e.shs_dn_tax_rate_per_uom*(e.qty*e.conversion_factor),t.doc.items[o].shs_dn_amount_minus_excise_tax=e.qty*e.rate-e.qty*e.conversion_factor*e.shs_dn_tax_rate_per_uom,e.shs_dn_is_fuel){t.doc.items[o].shs_dn_gt_tax_net_fuel_amt=e.shs_dn_amount_minus_excise_tax/(1+a/100),t.doc.items[o].shs_dn_sales_tax_for_this_row=e.shs_dn_gt_tax_net_fuel_amt*(a/100);var c=0;$.each(t.doc.items||[],function(t,e){1==e.shs_dn_is_fuel&&(c+=flt(e.shs_dn_gt_tax_net_fuel_amt))}),t.doc.shs_dn_gt_tax_fuel=c}if(e.shs_dn_is_good){t.doc.items[o].shs_dn_gt_tax_net_goods_amt=e.shs_dn_amount_minus_excise_tax/(1+a/100),t.doc.items[o].shs_dn_sales_tax_for_this_row=e.shs_dn_gt_tax_net_goods_amt*(a/100);var r=0;$.each(t.doc.items||[],function(t,e){1==e.shs_dn_is_good&&(r+=flt(e.shs_dn_gt_tax_net_goods_amt))}),t.doc.shs_dn_gt_tax_goods=r}if(e.shs_dn_is_service){t.doc.items[o].shs_dn_gt_tax_net_services_amt=e.shs_dn_amount_minus_excise_tax/(1+a/100),t.doc.items[o].shs_dn_sales_tax_for_this_row=e.shs_dn_gt_tax_net_services_amt*(a/100);var s=0;$.each(t.doc.items||[],function(t,e){1==e.shs_dn_is_service&&(s+=flt(e.shs_dn_gt_tax_net_services_amt))}),t.doc.shs_dn_gt_tax_services=s}var i=0;$.each(t.doc.items||[],function(t,e){i+=flt(e.shs_dn_sales_tax_for_this_row)}),t.doc.shs_dn_total_iva=i}})}function g(t,e){return t*e}function q(t,e,_){t.doc.items.forEach(function(e){y(t,"Sales Order Item",e.name)})}function y(t,e,_){cur_frm.refresh_fields();var a=cur_frm.doc.taxes[0].rate;t.doc.items.forEach(function(e,o){if(e.name==_){if(e.qty*e.rate,e.qty*e.conversion_factor,e.shs_so_tax_rate_per_uom,t.doc.items[o].shs_so_other_tax_amount=e.shs_so_tax_rate_per_uom*(e.qty*e.conversion_factor),t.doc.items[o].shs_so_amount_minus_excise_tax=e.qty*e.rate-e.qty*e.conversion_factor*e.shs_so_tax_rate_per_uom,e.shs_so_is_fuel){t.doc.items[o].shs_so_gt_tax_net_fuel_amt=e.shs_so_amount_minus_excise_tax/(1+a/100),t.doc.items[o].shs_so_sales_tax_for_this_row=e.shs_so_gt_tax_net_fuel_amt*(a/100);var c=0;$.each(t.doc.items||[],function(t,e){1==e.shs_so_is_fuel&&(c+=flt(e.shs_so_gt_tax_net_fuel_amt))}),t.doc.shs_gt_tax_fuel=c}if(e.shs_so_is_good){t.doc.items[o].shs_so_gt_tax_net_goods_amt=e.shs_so_amount_minus_excise_tax/(1+a/100),t.doc.items[o].shs_so_sales_tax_for_this_row=e.shs_so_gt_tax_net_goods_amt*(a/100);var r=0;$.each(t.doc.items||[],function(t,e){1==e.shs_so_is_good&&(r+=flt(e.shs_so_gt_tax_net_goods_amt))}),t.doc.shs_so_gt_tax_goods=r}if(e.shs_so_is_service){t.doc.items[o].shs_so_gt_tax_net_services_amt=e.shs_so_amount_minus_excise_tax/(1+a/100),t.doc.items[o].shs_so_sales_tax_for_this_row=e.shs_so_gt_tax_net_services_amt*(a/100);var s=0;$.each(t.doc.items||[],function(t,e){1==e.shs_so_is_service&&(s+=flt(e.shs_so_gt_tax_net_services_amt))}),t.doc.shs_so_gt_tax_services=s}var i=0;$.each(t.doc.items||[],function(t,e){i+=flt(e.shs_so_sales_tax_for_this_row)}),t.doc.shs_so_total_iva=i}})}function b(t,e,_){t.doc.items.forEach(function(e){E(t,"Quotation Item",e.name),F(t,"Quotation Item",e.name)})}function I(t,e){var _=0;return $.each(t.doc.items||[],function(t,a){a.facelec_qt_tax_rate_per_uom_account===e&&(_+=flt(a.facelec_qt_other_tax_amount))}),_}function w(t,e,_){t.doc.items.forEach(function(e,a){e.name===_&&e.facelec_qt_tax_rate_per_uom_account&&t.doc.shs_tax_quotation.forEach(function(_,a){if(_.account_head===e.facelec_qt_tax_rate_per_uom_account){var o;o=I(t,_.account_head),cur_frm.doc.shs_tax_quotation[a].total=o,P(t)}})})}function P(t){var e=0;$.each(t.doc.shs_tax_quotation||[],function(t,_){_.account_head&&(e+=flt(_.total))}),cur_frm.set_value("shs_qt_total_otros_imp_incl",e),t.refresh_field("shs_qt_total_otros_imp_incl")}function F(t,e,_){var a=0;t.doc.items.forEach(function(e,o){if(e.name===_){a=e.facelec_qt_other_tax_amount;var c=e.facelec_qt_tax_rate_per_uom_account;t.refresh_field("items"),t.refresh_field("conversion_factor"),c&&(!function(t,e){var _=!1;return $.each(t.doc.shs_tax_quotation||[],function(t,a){a.account_head===e&&(_=!0)}),_}(t,c)?(frappe.model.add_child(cur_frm.doc,"Otros Impuestos Factura Electronica","shs_tax_quotation"),cur_frm.refresh_field("items"),t.doc.shs_tax_quotation.forEach(function(e,o){void 0===e.account_head&&(cur_frm.doc.shs_tax_quotation[o].account_head=c,cur_frm.doc.shs_tax_quotation[o].total=a,cur_frm.refresh_field("shs_tax_quotation"),w(t,0,_),cur_frm.refresh_field("shs_tax_quotation"))})):(w(t,0,_),cur_frm.refresh_field("shs_tax_quotation")))}})}function E(t,e,_){cur_frm.refresh_fields();var a=cur_frm.doc.taxes[0].rate;t.doc.items.forEach(function(e,o){if(e.name==_){if(e.qty*e.rate,e.qty*e.conversion_factor,e.facelec_qt_tax_rate_per_uom,t.doc.items[o].facelec_qt_other_tax_amount=e.facelec_qt_tax_rate_per_uom*(e.qty*e.conversion_factor),t.doc.items[o].facelec_qt_amount_minus_excise_tax=e.qty*e.rate-e.qty*e.conversion_factor*e.facelec_qt_tax_rate_per_uom,e.facelec_qt_is_fuel){t.doc.items[o].facelec_qt_gt_tax_net_fuel_amt=e.facelec_qt_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_qt_sales_tax_for_this_row=e.facelec_qt_gt_tax_net_fuel_amt*(a/100);var c=0;$.each(t.doc.items||[],function(t,e){1==e.facelec_qt_is_fuel&&(c+=flt(e.facelec_qt_gt_tax_net_fuel_amt))}),t.doc.facelec_qt_gt_tax_fuel=c}if(e.facelec_qt_is_good){t.doc.items[o].facelec_qt_gt_tax_net_goods_amt=e.facelec_qt_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_qt_sales_tax_for_this_row=e.facelec_qt_gt_tax_net_goods_amt*(a/100);var r=0;$.each(t.doc.items||[],function(t,e){1==e.facelec_qt_is_good&&(r+=flt(e.facelec_qt_gt_tax_net_goods_amt))}),t.doc.facelec_qt_gt_tax_goods=r}if(1==e.facelec_qt_is_service){t.doc.items[o].facelec_qt_gt_tax_net_services_amt=e.facelec_qt_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_qt_sales_tax_for_this_row=e.facelec_qt_gt_tax_net_services_amt*(a/100);var s=0;$.each(t.doc.items||[],function(t,e){1==e.facelec_qt_is_service&&(s+=flt(e.facelec_qt_gt_tax_net_services_amt))}),t.doc.facelec_qt_gt_tax_services=s}var i=0;$.each(t.doc.items||[],function(t,e){i+=flt(e.facelec_qt_sales_tax_for_this_row)}),t.doc.facelec_qt_total_iva=i}})}function S(t,e,_){t.doc.items.forEach(function(e){A(t,"Purchase Invoice Item",e.name),O(t,"Purchase Invoice Item",e.name)})}function k(t,e){var _=0;return $.each(t.doc.items||[],function(t,a){a.facelec_p_tax_rate_per_uom_account===e&&(_+=flt(a.facelec_p_other_tax_amount))}),_}function T(t,e,_){t.doc.items.forEach(function(e,a){e.name===_&&e.facelec_p_tax_rate_per_uom_account&&t.doc.shs_pi_otros_impuestos.forEach(function(_,a){if(_.account_head===e.facelec_p_tax_rate_per_uom_account){var o;o=k(t,_.account_head),cur_frm.doc.shs_pi_otros_impuestos[a].total=o,N(t)}})})}function N(t){var e=0;$.each(t.doc.shs_pi_otros_impuestos||[],function(t,_){_.account_head&&(e+=flt(_.total))}),cur_frm.set_value("shs_pi_total_otros_imp_incl",e),t.refresh_field("shs_pi_total_otros_imp_incl")}function O(t,e,_){var a=0;t.doc.items.forEach(function(e,o){if(e.name===_){a=e.facelec_p_other_tax_amount;var c=e.facelec_p_tax_rate_per_uom_account;t.refresh_field("items"),t.refresh_field("conversion_factor"),c&&(!function(t,e){var _=!1;return $.each(t.doc.shs_pi_otros_impuestos||[],function(t,a){a.account_head===e&&(_=!0)}),_}(t,c)?(frappe.model.add_child(cur_frm.doc,"Otros Impuestos Factura Electronica","shs_pi_otros_impuestos"),cur_frm.refresh_field("items"),t.doc.shs_pi_otros_impuestos.forEach(function(e,o){void 0===e.account_head&&(cur_frm.doc.shs_pi_otros_impuestos[o].account_head=c,cur_frm.doc.shs_pi_otros_impuestos[o].total=a,cur_frm.refresh_field("shs_pi_otros_impuestos"),T(t,0,_),cur_frm.refresh_field("shs_pi_otros_impuestos"))})):(T(t,0,_),cur_frm.refresh_field("shs_pi_otros_impuestos")))}})}function A(t,e,_){cur_frm.refresh_fields();var a=cur_frm.doc.taxes[0].rate;t.doc.items.forEach(function(e,o){if(e.name==_){if(e.qty*e.rate,e.qty*e.conversion_factor,e.facelec_p_tax_rate_per_uom,t.doc.items[o].facelec_p_other_tax_amount=e.facelec_p_tax_rate_per_uom*(e.qty*e.conversion_factor),t.doc.items[o].facelec_p_amount_minus_excise_tax=e.qty*e.rate-e.qty*e.conversion_factor*e.facelec_p_tax_rate_per_uom,e.facelec_p_is_fuel){t.doc.items[o].facelec_p_gt_tax_net_fuel_amt=e.facelec_p_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_p_sales_tax_for_this_row=e.facelec_p_gt_tax_net_fuel_amt*(a/100);var c=0;$.each(t.doc.items||[],function(t,e){1==e.facelec_p_is_fuel&&(c+=flt(e.facelec_p_gt_tax_net_fuel_amt))}),t.doc.facelec_p_gt_tax_fuel=c}if(e.facelec_p_is_good){t.doc.items[o].facelec_p_gt_tax_net_goods_amt=e.facelec_p_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_p_sales_tax_for_this_row=e.facelec_p_gt_tax_net_goods_amt*(a/100);var r=0;$.each(t.doc.items||[],function(t,e){1==e.facelec_p_is_good&&(r+=flt(e.facelec_p_gt_tax_net_goods_amt))}),t.doc.facelec_p_gt_tax_goods=r}if(1==e.facelec_p_is_service){t.doc.items[o].facelec_p_gt_tax_net_services_amt=e.facelec_p_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_p_sales_tax_for_this_row=e.facelec_p_gt_tax_net_services_amt*(a/100);var s=0;$.each(t.doc.items||[],function(t,e){1==e.facelec_p_is_service&&(s+=flt(e.facelec_p_gt_tax_net_services_amt))}),t.doc.facelec_p_gt_tax_services=s}var i=0;$.each(t.doc.items||[],function(t,e){i+=flt(e.facelec_p_sales_tax_for_this_row)}),t.doc.facelec_p_total_iva=i}})}function Q(t,e){return t*e}function R(t,e,_){t.doc.items.forEach(function(e){D(t,"Purchase Receipt Item",e.name)})}function D(t,e,_){cur_frm.refresh_fields();var a=cur_frm.doc.taxes[0].rate;t.doc.items.forEach(function(e,o){if(e.name==_){if(e.qty*e.rate,e.qty*e.conversion_factor,e.facelec_pr_tax_rate_per_uom,t.doc.items[o].facelec_pr_other_tax_amount=e.facelec_pr_tax_rate_per_uom*(e.qty*e.conversion_factor),t.doc.items[o].facelec_pr_amount_minus_excise_tax=e.qty*e.rate-e.qty*e.conversion_factor*e.facelec_pr_tax_rate_per_uom,e.facelec_pr_is_fuel){t.doc.items[o].facelec_pr_gt_tax_net_fuel_amt=e.facelec_pr_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_pr_sales_tax_for_this_row=e.facelec_pr_gt_tax_net_fuel_amt*(a/100);var c=0;$.each(t.doc.items||[],function(t,e){1==e.facelec_pr_is_fuel&&(c+=flt(e.facelec_pr_gt_tax_net_fuel_amt))}),t.doc.facelec_pr_gt_tax_fuel=c}if(e.facelec_pr_is_good){t.doc.items[o].facelec_pr_gt_tax_net_goods_amt=e.facelec_pr_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_pr_sales_tax_for_this_row=e.facelec_pr_gt_tax_net_goods_amt*(a/100);var r=0;$.each(t.doc.items||[],function(t,e){1==e.facelec_pr_is_good&&(r+=flt(e.facelec_pr_gt_tax_net_goods_amt))}),t.doc.facelec_pr_gt_tax_goods=r}if(e.facelec_pr_is_service){t.doc.items[o].facelec_pr_gt_tax_net_services_amt=e.facelec_pr_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_pr_sales_tax_for_this_row=e.facelec_pr_gt_tax_net_services_amt*(a/100);var s=0;$.each(t.doc.items||[],function(t,e){1==e.facelec_pr_is_service&&(s+=flt(e.facelec_pr_gt_tax_net_services_amt))}),t.doc.facelec_pr_gt_tax_services=s}var i=0;$.each(t.doc.items||[],function(t,e){i+=flt(e.facelec_pr_sales_tax_for_this_row)}),t.doc.facelec_pr_total_iva=i}})}function C(t,e){return t*e}function G(t,e,_){t.doc.items.forEach(function(e){M(t,"Purchase Order Item",e.name)})}function M(t,e,_){cur_frm.refresh_fields();var a=cur_frm.doc.taxes[0].rate;t.doc.items.forEach(function(e,o){if(e.name==_){if(e.qty*e.rate,e.qty*e.conversion_factor,e.facelec_po_tax_rate_per_uom,t.doc.items[o].facelec_po_other_tax_amount=e.facelec_po_tax_rate_per_uom*(e.qty*e.conversion_factor),t.doc.items[o].facelec_po_amount_minus_excise_tax=e.qty*e.rate-e.qty*e.conversion_factor*e.facelec_po_tax_rate_per_uom,e.facelec_po_is_fuel){t.doc.items[o].facelec_po_gt_tax_net_fuel_amt=e.facelec_po_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_po_sales_tax_for_this_row=e.facelec_po_gt_tax_net_fuel_amt*(a/100);var c=0;$.each(t.doc.items||[],function(t,e){1==e.facelec_po_is_fuel&&(c+=flt(e.facelec_po_gt_tax_net_fuel_amt))}),t.doc.facelec_po_gt_tax_fuel=c}if(e.facelec_po_is_good){t.doc.items[o].facelec_po_gt_tax_net_goods_amt=e.facelec_po_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_po_sales_tax_for_this_row=e.facelec_po_gt_tax_net_goods_amt*(a/100);var r=0;$.each(t.doc.items||[],function(t,e){1==e.facelec_po_is_good&&(r+=flt(e.facelec_po_gt_tax_net_goods_amt))}),t.doc.facelec_po_gt_tax_goods=r}if(e.facelec_po_is_service){t.doc.items[o].facelec_po_gt_tax_net_services_amt=e.facelec_po_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_po_sales_tax_for_this_row=e.facelec_po_gt_tax_net_services_amt*(a/100);var s=0;$.each(t.doc.items||[],function(t,e){1==e.facelec_po_is_service&&(s+=flt(e.facelec_po_gt_tax_net_services_amt))}),t.doc.facelec_po_gt_tax_services=s}var i=0;$.each(t.doc.items||[],function(t,e){i+=flt(e.facelec_po_sales_tax_for_this_row)}),t.doc.facelec_po_total_iva=i}})}function U(t,e,_){t.doc.items.forEach(function(e){j(t,"Supplier Quotation Item",e.name)})}function j(t,e,_){cur_frm.refresh_fields();var a=cur_frm.doc.taxes[0].rate;t.doc.items.forEach(function(e,o){if(e.name==_){if(e.qty*e.rate,e.qty*e.conversion_factor,e.shs_spq_tax_rate_per_uom,t.doc.items[o].shs_spq_other_tax_amount=e.shs_spq_tax_rate_per_uom*(e.qty*e.conversion_factor),t.doc.items[o].shs_spq_amount_minus_excise_tax=e.qty*e.rate-e.qty*e.conversion_factor*e.shs_spq_tax_rate_per_uom,e.shs_spq_is_fuel){t.doc.items[o].shs_spq_gt_tax_net_fuel_amt=e.shs_spq_amount_minus_excise_tax/(1+a/100),t.doc.items[o].shs_spq_sales_tax_for_this_row=e.shs_spq_gt_tax_net_fuel_amt*(a/100);var c=0;$.each(t.doc.items||[],function(t,e){1==e.shs_spq_is_fuel&&(c+=flt(e.shs_spq_gt_tax_net_fuel_amt))}),t.doc.shs_spq_gt_tax_fuel=c}if(e.shs_spq_is_good){t.doc.items[o].shs_spq_gt_tax_net_goods_amt=e.shs_spq_amount_minus_excise_tax/(1+a/100),t.doc.items[o].shs_spq_sales_tax_for_this_row=e.shs_spq_gt_tax_net_goods_amt*(a/100);var r=0;$.each(t.doc.items||[],function(t,e){1==e.shs_spq_is_good&&(r+=flt(e.shs_spq_gt_tax_net_goods_amt))}),t.doc.shs_spq_gt_tax_goods=r}if(e.shs_spq_is_service){t.doc.items[o].shs_spq_gt_tax_net_services_amt=e.shs_spq_amount_minus_excise_tax/(1+a/100),t.doc.items[o].shs_spq_sales_tax_for_this_row=e.shs_spq_gt_tax_net_services_amt*(a/100);var s=0;$.each(t.doc.items||[],function(t,e){1==e.shs_spq_is_service&&(s+=flt(e.shs_spq_gt_tax_net_services_amt))}),t.doc.shs_spq_gt_tax_services=s}var i=0;$.each(t.doc.items||[],function(t,e){i+=flt(e.shs_spq_sales_tax_for_this_row)}),t.doc.shs_spq_total_iva=i}})}return console.log("Se cargo exitosamente la aplicación de Factura Electrónica"),frappe.ui.form.on("Item",{facelec_is_fuel:function(t,e,_){t.doc.facelec_is_fuel&&(cur_frm.set_value("facelec_is_good",0),cur_frm.set_value("facelec_is_service",0))},facelec_is_good:function(t,e,_){t.doc.facelec_is_good&&(cur_frm.set_value("facelec_is_fuel",0),cur_frm.set_value("facelec_is_service",0))},facelec_is_service:function(t,e,_){t.doc.facelec_is_service&&(cur_frm.set_value("facelec_is_fuel",0),cur_frm.set_value("facelec_is_good",0))}}),frappe.ui.form.on("Customer",{nit_face_customer:function(t){e(t.doc.nit_face_customer,t.doc.name,t)}}),frappe.ui.form.on("Supplier",{facelec_nit_proveedor:function(t){e(t.doc.facelec_nit_proveedor,t.doc.name,t)}}),frappe.ui.form.on("Sales Invoice",{onload_post_render:function(t,e,_){t.fields_dict.items.grid.wrapper.on("focusout blur",'input[data-fieldname="item_code"][data-doctype="Sales Invoice Item"]',function(e){r(t),c(t,0,_)}),t.fields_dict.items.grid.wrapper.on("click",'input[data-fieldname="uom"][data-doctype="Sales Invoice Item"]',function(e){r(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="uom"][data-doctype="Sales Invoice Item"]',function(e){r(t)}),t.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="uom"][data-doctype="Sales Invoice Item"]',function(e){c(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="item_name"][data-doctype="Sales Invoice Item"]',function(e){r(t),f(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Sales Invoice Item"]',function(e){r(t)}),t.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="qty"][data-doctype="Sales Invoice Item"]',function(e){r(t),c(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Sales Invoice Item"]',function(e){r(t),cur_frm.refresh_field("conversion_factor")}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Sales Invoice Item"]',function(e){c(t,0,_),r(t),cur_frm.refresh_field("conversion_factor")}),t.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="rate"][data-doctype="Sales Invoice Item"]',function(t){}),cur_frm.fields_dict.customer.$input.on("blur",function(e){c(t,0,_),r(t),refresh_field("qty")}),cur_frm.fields_dict.customer.$input.on("blur focusout",function(e){c(t,0,_)}),cur_frm.fields_dict.taxes_and_charges.$input.on("focusout",function(e){c(t,0,_),f(t,0,_)})},refresh:function(t,e,_){cur_frm.add_fetch("customer","nit_face_customer","nit_face_customer"),t.add_custom_button("UOM Recalculation",function(){t.doc.items.forEach(function(e){c(t,0,e.name)})}),p("manual",t)},validate:function(t){!function(t){if(t.doc.items.length>0){var e=t.doc.items,_=Array.from(e);frappe.call({method:"factura_electronica.api.generar_tabla_html",args:{tabla:JSON.stringify(_)},callback:function(e){t.set_value("other_tax_facelec",e.message),t.refresh_field("other_tax_facelec")}})}}(t)},nit_face_customer:function(t,_,a){e(t.doc.nit_face_customer,t.doc.customer,t)},additional_discount_percentage:function(t,e,_){},discount_amount:function(t,e,_){t.doc.facelec_total_iva;var a=t.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100);if(NaN==a||null==a);else{var o=a*(cur_frm.doc.taxes[0].rate/100);t.doc.facelec_total_iva=t.doc.facelec_total_iva-o}},before_save:function(t,e,_){r(t),f(t,0,_)},on_submit:function(t,e,_){var a={};t.doc.shs_otros_impuestos.forEach(function(t,e){t.account_head&&(a[t.account_head]=t.total)}),Object.keys(a).length>0?frappe.call({method:"factura_electronica.resources_facelec.special_tax.add_gl_entry_other_special_tax",args:{invoice_name:t.doc.name,accounts:a,invoice_type:"Sales Invoice"},callback:function(){t.reload_doc(),frappe.call({method:"factura_electronica.api.obtenerConfiguracionManualAutomatica",callback:function(e){e.message,"Automatico"===e.message&&p("automatico",t)}})}}):frappe.call({method:"factura_electronica.api.obtenerConfiguracionManualAutomatica",callback:function(e){e.message,"Automatico"===e.message&&p("automatico",t)}})},naming_series:function(t,e,_){frappe.call({method:"factura_electronica.api.obtener_numero_resolucion",args:{nombre_serie:t.doc.naming_series},callback:function(t){void 0===t.message?cur_frm.set_value("shs_numero_resolucion",""):cur_frm.set_value("shs_numero_resolucion",t.message)}})}}),frappe.ui.form.on("Sales Invoice Item",{items_add:function(t,e,_){},items_move:function(t,e,_){},before_items_remove:function(t,e,_){t.doc.items.forEach(function(e,a){e.name==_&&function(t,e,_,a){t.doc.items.forEach(function(e,o){if(e.facelec_tax_rate_per_uom_account===_){var c=s(t,_)-a;void 0!==t.doc.shs_otros_impuestos&&t.doc.shs_otros_impuestos.forEach(function(e,a){e.account_head===_&&(cur_frm.doc.shs_otros_impuestos[a].total=c,cur_frm.refresh_field("shs_otros_impuestos"),n(t),cur_frm.refresh_field("shs_otros_impuestos"),e.total||(cur_frm.doc.shs_otros_impuestos.splice(cur_frm.doc.shs_otros_impuestos[a],1),cur_frm.refresh_field("shs_otros_impuestos")))})}})}(t,0,e.facelec_tax_rate_per_uom_account,e.facelec_other_tax_amount)})},items_remove:function(t,e,_){},item_code:function(t,e,_){r(t)},qty:function(t,e,_){c(t,0,_)},uom:function(t,e,_){},conversion_factor:function(t,e,_){c(t,0,_)},facelec_tax_rate_per_uom_account:function(t,e,_){},rate:function(t,e,_){c(t,0,_)},shs_amount_for_back_calc:function(t,e,a){t.doc.items.forEach(function(e,a){var o=e.rate,c=e.qty,r=(e.amount,_({Func:h,aFuncParams:[c,o],oFuncArgTarget:{Position:0},Goal:e.shs_amount_for_back_calc,Tol:.001,maxIter:1e4}));console.log(r),t.doc.items[a].qty=r,t.doc.items[a].stock_qty=r,t.doc.items[a].amount=r*t.doc.items[a].rate,t.refresh_field("items")})}}),frappe.ui.form.on("Delivery Note",{onload_post_render:function(t,e,_){t.fields_dict.items.grid.wrapper.on("focusout blur",'input[data-fieldname="item_code"][data-doctype="Delivery Note Item"]',function(e){x(t,0,_),v(t)}),t.fields_dict.items.grid.wrapper.on("click",'input[data-fieldname="uom"][data-doctype="Delivery Note Item"]',function(e){v(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="uom"][data-doctype="Delivery Note Item"]',function(e){v(t)}),t.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="uom"][data-doctype="Delivery Note Item"]',function(e){x(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="item_name"][data-doctype="Delivery Note Item"]',function(e){v(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Delivery Note Item"]',function(e){v(t)}),t.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="qty"][data-doctype="Delivery Note Item"]',function(e){v(t),x(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Delivery Note Item"]',function(e){v(t),cur_frm.refresh_field("conversion_factor")}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Delivery Note Item"]',function(e){x(t,0,_),v(t),cur_frm.refresh_field("conversion_factor")}),cur_frm.fields_dict.customer.$input.on("blur focusout",function(e){x(t,0,_)}),cur_frm.fields_dict.items.$wrapper.on("blur focusout",function(e){v(t)}),cur_frm.fields_dict.taxes_and_charges.$input.on("blur focusout",function(e){x(t,0,_)})},shs_dn_nit:function(t){e(t.doc.shs_dn_nit,t.doc.customer,t)},discount_amount:function(t){t.doc.shs_dn_total_iva;var e=t.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100);NaN==e||null==e||(discount_amount_tax_value=e*(cur_frm.doc.taxes[0].rate/100),t.doc.shs_dn_total_iva=t.doc.shs_dn_total_iva-discount_amount_tax_value)},before_save:function(t,e,_){v(t)}}),frappe.ui.form.on("Delivery Note Item",{items_remove:function(t){var e=0,_=0,a=0,o=0;$.each(t.doc.items||[],function(t,c){e+=flt(c.shs_dn_gt_tax_net_fuel_amt),_+=flt(c.shs_dn_gt_tax_net_goods_amt),a+=flt(c.shs_dn_gt_tax_net_services_amt),o+=flt(c.shs_dn_sales_tax_for_this_row)}),cur_frm.set_value("shs_dn_gt_tax_fuel",e),cur_frm.set_value("shs_dn_gt_tax_goods",_),cur_frm.set_value("shs_dn_gt_tax_services",a),cur_frm.set_value("shs_dn_total_iva",o)},item_code:function(t,e,_){refresh_field("qty")},qty:function(t,e,_){x(t,0,_)},conversion_factor:function(t,e,_){x(t,0,_)},rate:function(t,e,_){x(t,0,_)},shs_amount_for_back_calc:function(t,e,a){t.doc.items.forEach(function(e,a){var o=e.rate,c=e.qty,r=(e.amount,_({Func:g,aFuncParams:[c,o],oFuncArgTarget:{Position:0},Goal:e.shs_amount_for_back_calc,Tol:.001,maxIter:1e4}));console.log(r),t.doc.items[a].qty=r,t.doc.items[a].stock_qty=r,t.doc.items[a].amount=r*t.doc.items[a].rate,t.refresh_field("items")})}}),frappe.ui.form.on("Sales Order",{onload_post_render:function(t,e,_){t.fields_dict.items.grid.wrapper.on("focusout blur",'input[data-fieldname="item_code"][data-doctype="Sales Order Item"]',function(e){y(t,0,_),q(t)}),t.fields_dict.items.grid.wrapper.on("click",'input[data-fieldname="uom"][data-doctype="Sales Order Item"]',function(e){q(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="uom"][data-doctype="Sales Order Item"]',function(e){q(t)}),t.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="uom"][data-doctype="Sales Order Item"]',function(e){y(t,0,_)}),t.fields_dict.items.grid.wrapper.on("focus",'input[data-fieldname="item_name"][data-doctype="Sales Order Item"]',function(e){q(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Sales Order Item"]',function(e){q(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Sales Order Item"]',function(e){q(t),y(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="conversion_factor"][data-doctype="Sales Order Item"]',function(e){q(t),cur_frm.refresh_field("conversion_factor")}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Sales Order Item"]',function(e){y(t,0,_),q(t),cur_frm.refresh_field("conversion_factor")}),cur_frm.fields_dict.customer.$input.on("blur focusout",function(e){y(t,0,_)}),cur_frm.fields_dict.items.$wrapper.on("blur focusout",function(e){q(t)}),cur_frm.fields_dict.taxes_and_charges.$input.on("focusout",function(e){y(t,0,_)})},shs_so_nit:function(t){e(t.doc.shs_so_nit,t.doc.customer,t)},discount_amount:function(t){t.doc.shs_so_total_iva;var e=t.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100);NaN==e||null==e||(discount_amount_tax_value=e*(cur_frm.doc.taxes[0].rate/100),t.doc.shs_so_total_iva=t.doc.shs_so_total_iva-discount_amount_tax_value)},before_save:function(t,e,_){q(t)}}),frappe.ui.form.on("Sales Order Item",{items_remove:function(t){var e=0,_=0,a=0,o=0;$.each(t.doc.items||[],function(t,c){e+=flt(c.shs_so_gt_tax_net_fuel_amt),_+=flt(c.shs_so_gt_tax_net_goods_amt),a+=flt(c.shs_so_gt_tax_net_services_amt),o+=flt(c.shs_so_sales_tax_for_this_row)}),cur_frm.set_value("shs_gt_tax_fuel",e),cur_frm.set_value("shs_so_gt_tax_goods",_),cur_frm.set_value("shs_so_gt_tax_services",a),cur_frm.set_value("shs_so_total_iva",o)},item_code:function(t,e,_){cur_frm.doc.taxes[0].rate;refresh_field("qty")},qty:function(t,e,_){y(t,0,_)},conversion_factor:function(t,e,_){y(t,0,_)},rate:function(t,e,_){y(t,0,_)}}),frappe.ui.form.on("Quotation",{onload_post_render:function(t,e,_){t.fields_dict.items.grid.wrapper.on("focusout blur",'input[data-fieldname="item_code"][data-doctype="Quotation Item"]',function(e){E(t,0,_),b(t)}),t.fields_dict.items.grid.wrapper.on("click",'input[data-fieldname="uom"][data-doctype="Quotation Item"]',function(e){b(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="uom"][data-doctype="Quotation Item"]',function(e){b(t)}),t.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="uom"][data-doctype="Quotation Item"]',function(e){E(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur ",'input[data-fieldname="item_name"][data-doctype="Quotation Item"]',function(e){b(t),F(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Quotation Item"]',function(e){b(t)}),t.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="qty"][data-doctype="Quotation Item"]',function(e){b(t),E(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Quotation Item"]',function(e){b(t),cur_frm.refresh_field("conversion_factor")}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Quotation Item"]',function(e){E(t,0,_),b(t),cur_frm.refresh_field("conversion_factor")}),cur_frm.fields_dict.customer.$input.on("blur focusout",function(e){E(t,0,_)}),cur_frm.fields_dict.items.$wrapper.on("blur focusout",function(e){b(t)}),cur_frm.fields_dict.taxes_and_charges.$input.on("blur focusout",function(e){E(t,0,_),F(t,0,_)})},facelec_qt_nit:function(t,_,a){e(t.doc.facelec_qt_nit,t.doc.customer,t)},discount_amount:function(t,e,_){t.doc.facelec_total_iva;var a=t.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100);NaN==a||null==a||(discount_amount_tax_value=a*(cur_frm.doc.taxes[0].rate/100),t.doc.facelec_total_iva=t.doc.facelec_total_iva-discount_amount_tax_value)},before_save:function(t,e,_){b(t),F(t,0,_)}}),frappe.ui.form.on("Quotation Item",{before_items_remove:function(t,e,_){t.doc.items.forEach(function(e,a){e.name==_&&function(t,e,_){t.doc.items.forEach(function(a,o){if(a.facelec_qt_tax_rate_per_uom_account===e){var c=I(t,e)-_;t.doc.shs_tax_quotation.forEach(function(_,a){_.account_head===e&&(cur_frm.doc.shs_tax_quotation[a].total=c,cur_frm.refresh_field("shs_tax_quotation"),P(t),cur_frm.refresh_field("shs_tax_quotation"),0===_.total&&(cur_frm.doc.shs_tax_quotation.splice(cur_frm.doc.shs_tax_quotation[a],1),cur_frm.refresh_field("shs_tax_quotation")))})}})}(t,e.facelec_qt_tax_rate_per_uom_account,e.facelec_qt_other_tax_amount)})},items_remove:function(t,e,_){var a=0,o=0,c=0,r=0;$.each(t.doc.items||[],function(t,e){a+=flt(e.facelec_qt_gt_tax_net_fuel_amt),o+=flt(e.facelec_qt_gt_tax_net_goods_amt),c+=flt(e.facelec_qt_gt_tax_net_services_amt),r+=flt(e.facelec_qt_sales_tax_for_this_row)}),cur_frm.set_value("facelec_qt_gt_tax_fuel",a),cur_frm.set_value("facelec_qt_gt_tax_goods",o),cur_frm.set_value("facelec_qt_gt_tax_services",c),cur_frm.set_value("facelec_qt_total_iva",r)},item_code:function(t,e,_){cur_frm.doc.taxes[0].rate;refresh_field("qty")},qty:function(t,e,_){E(t,0,_)},uom:function(t,e,_){},conversion_factor:function(t,e,_){E(t,0,_)},rate:function(t,e,_){E(t,0,_)}}),frappe.ui.form.on("Purchase Invoice",{onload_post_render:function(t,e,_){t.fields_dict.items.grid.wrapper.on("focusout blur",'input[data-fieldname="item_code"][data-doctype="Purchase Invoice Item"]',function(e){A(t,0,_),S(t)}),t.fields_dict.items.grid.wrapper.on("click",'input[data-fieldname="uom"][data-doctype="Purchase Invoice Item"]',function(e){S(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="uom"][data-doctype="Purchase Invoice Item"]',function(e){S(t)}),t.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="uom"][data-doctype="Purchase Invoice Item"]',function(e){A(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="item_name"][data-doctype="Purchase Invoice Item"]',function(e){S(t),O(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Purchase Invoice Item"]',function(e){S(t)}),t.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="qty"][data-doctype="Purchase Invoice Item"]',function(e){S(t),A(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Purchase Invoice Item"]',function(e){S(t),cur_frm.refresh_field("conversion_factor")}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Purchase Invoice Item"]',function(e){A(t,0,_),S(t),cur_frm.refresh_field("conversion_factor")}),cur_frm.fields_dict.supplier.$input.on("blur focusout",function(e){A(t,0,_)}),cur_frm.fields_dict.items.$wrapper.on("blur",function(e){S(t)}),cur_frm.fields_dict.taxes_and_charges.$input.on("focusout",function(e){A(t,0,_),O(t,0,_)})},facelec_nit_fproveedor:function(t,_,a){e(t.doc.facelec_nit_fproveedor,t.doc.supplier,t)},discount_amount:function(t,e,_){t.doc.facelec_total_iva;var a=t.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100);NaN==a||null==a||(discount_amount_tax_value=a*(cur_frm.doc.taxes[0].rate/100),t.doc.facelec_total_iva=t.doc.facelec_total_iva-discount_amount_tax_value)},before_save:function(t,e,_){S(t),O(t,0,_)},validate:function(t){!function(t){if(t.doc.items.length>0){var e=t.doc.items,_=Array.from(e);frappe.call({method:"factura_electronica.api.generar_tabla_html_factura_compra",args:{tabla:JSON.stringify(_)},callback:function(e){t.set_value("other_tax_facelec",e.message),t.refresh_field("other_tax_facelec")}})}}(t)},on_submit:function(t,e,_){var a={};t.doc.shs_pi_otros_impuestos.forEach(function(t,e){t.account_head&&(a[t.account_head]=t.total)}),Object.keys(a).length>0&&frappe.call({method:"factura_electronica.resources_facelec.special_tax.add_gl_entry_other_special_tax",args:{invoice_name:t.doc.name,accounts:a,invoice_type:"Purchase Invoice"},callback:function(){}})},naming_series:function(t,e,_){console.log(t.doc.naming_series),frappe.call({method:"factura_electronica.resources_facelec.special_invoice.verificar_existencia_series",args:{serie:t.doc.naming_series},callback:function(e){console.log(e.message),"fail"!=e.message&&(cur_frm.clear_table("taxes"),cur_frm.refresh_fields(),t.set_value("taxes_and_charges",e.message[2]),t.refresh_field("taxes_and_charges"))}})}}),frappe.ui.form.on("Purchase Invoice Item",{before_items_remove:function(t,e,_){t.doc.items.forEach(function(e,a){e.name==_&&function(t,e,_){t.doc.items.forEach(function(a,o){if(a.facelec_p_tax_rate_per_uom_account===e){var c=k(t,e)-_;void 0!==t.doc.shs_pi_otros_impuestos&&t.doc.shs_pi_otros_impuestos.forEach(function(_,a){_.account_head===e&&(cur_frm.doc.shs_pi_otros_impuestos[a].total=c,cur_frm.refresh_field("shs_pi_otros_impuestos"),N(t),cur_frm.refresh_field("shs_pi_otros_impuestos"),_.total||(cur_frm.doc.shs_pi_otros_impuestos.splice(cur_frm.doc.shs_pi_otros_impuestos[a],1),cur_frm.refresh_field("shs_pi_otros_impuestos")))})}})}(t,e.facelec_p_tax_rate_per_uom_account,e.facelec_p_other_tax_amount)})},items_remove:function(t,e,_){var a=0,o=0,c=0,r=0;$.each(t.doc.items||[],function(t,e){a+=flt(e.facelec_p_gt_tax_net_fuel_amt),o+=flt(e.facelec_p_gt_tax_net_goods_amt),c+=flt(e.facelec_p_gt_tax_net_services_amt),r+=flt(e.facelec_p_sales_tax_for_this_row)}),cur_frm.set_value("facelec_p_gt_tax_fuel",a),cur_frm.set_value("facelec_p_gt_tax_goods",o),cur_frm.set_value("facelec_p_gt_tax_services",c),cur_frm.set_value("facelec_p_total_iva",r)},item_code:function(t,e,_){cur_frm.doc.taxes[0].rate;refresh_field("qty")},qty:function(t,e,_){A(t,0,_)},uom:function(t,e,_){},conversion_factor:function(t,e,_){A(t,0,_)},rate:function(t,e,_){A(t,0,_)},shs_amount_for_back_calc:function(t,e,a){t.doc.items.forEach(function(e,o){var c=e.rate,r=e.qty,s=(e.amount,_({Func:Q,aFuncParams:[r,c],oFuncArgTarget:{Position:0},Goal:e.shs_amount_for_back_calc,Tol:.001,maxIter:1e4}));console.log(s),t.doc.items[o].qty=s,t.doc.items[o].stock_qty=s,t.doc.items[o].amount=s*t.doc.items[o].rate,t.refresh_field("items"),S(t),O(t,0,a)})}}),frappe.ui.form.on("Purchase Receipt",{onload_post_render:function(t,e,_){t.fields_dict.items.grid.wrapper.on("focusout blur",'input[data-fieldname="item_code"][data-doctype="Purchase Receipt Item"]',function(e){D(t,0,_),R(t)}),t.fields_dict.items.grid.wrapper.on("click",'input[data-fieldname="uom"][data-doctype="Purchase Receipt Item"]',function(e){R(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="uom"][data-doctype="Purchase Receipt Item"]',function(e){R(t)}),t.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="uom"][data-doctype="Purchase Receipt Item"]',function(e){D(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="item_name"][data-doctype="Purchase Receipt Item"]',function(e){R(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Purchase Receipt Item"]',function(e){R(t)}),t.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="qty"][data-doctype="Purchase Receipt Item"]',function(e){R(t),D(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Purchase Receipt Item"]',function(e){R(t),cur_frm.refresh_field("conversion_factor")}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Purchase Receipt Item"]',function(e){D(t,0,_),R(t),cur_frm.refresh_field("conversion_factor")}),cur_frm.fields_dict.supplier.$input.on("blur focusout",function(e){D(t,0,_)}),cur_frm.fields_dict.items.$wrapper.on("blur",function(e){R(t)}),cur_frm.fields_dict.taxes_and_charges.$input.on("blur focusout",function(e){D(t,0,_)})},facelec_nit_prproveedor:function(t){e(t.doc.facelec_nit_prproveedor,t.doc.supplier,t)},discount_amount:function(t){t.doc.facelec_pr_total_iva;var e=t.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100);NaN==e||null==e||(discount_amount_tax_value=e*(cur_frm.doc.taxes[0].rate/100),t.doc.facelec_pr_total_iva=t.doc.facelec_pr_total_iva-discount_amount_tax_value)},before_save:function(t,e,_){R(t)}}),frappe.ui.form.on("Purchase Receipt Item",{items_remove:function(t){var e=0,_=0,a=0,o=0;$.each(t.doc.items||[],function(t,c){e+=flt(c.facelec_pr_gt_tax_net_fuel_amt),_+=flt(c.facelec_pr_gt_tax_net_goods_amt),a+=flt(c.facelec_pr_gt_tax_net_services_amt),o+=flt(c.facelec_pr_sales_tax_for_this_row)}),cur_frm.set_value("facelec_pr_gt_tax_fuel",e),cur_frm.set_value("facelec_pr_gt_tax_goods",_),cur_frm.set_value("facelec_pr_gt_tax_services",a),cur_frm.set_value("facelec_pr_total_iva",o)},item_code:function(t,e,_){cur_frm.doc.taxes[0].rate;refresh_field("qty")},qty:function(t,e,_){D(t,0,_)},conversion_factor:function(t,e,_){D(t,0,_)},rate:function(t,e,_){D(t,0,_)},shs_amount_for_back_calc:function(t,e,a){t.doc.items.forEach(function(e,a){var o=e.rate,c=e.qty,r=(e.amount,_({Func:C,aFuncParams:[c,o],oFuncArgTarget:{Position:0},Goal:e.shs_amount_for_back_calc,Tol:.001,maxIter:1e4}));console.log(r),t.doc.items[a].qty=r,t.doc.items[a].stock_qty=r,t.doc.items[a].amount=r*t.doc.items[a].rate,t.refresh_field("items")})}}),frappe.ui.form.on("Purchase Order",{onload_post_render:function(t,e,_){t.fields_dict.items.grid.wrapper.on("focusout blur",'input[data-fieldname="item_code"][data-doctype="Purchase Order Item"]',function(e){M(t,0,_),G(t)}),t.fields_dict.items.grid.wrapper.on("click",'input[data-fieldname="uom"][data-doctype="Purchase Order Item"]',function(e){G(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="uom"][data-doctype="Purchase Order Item"]',function(e){G(t)}),t.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="uom"][data-doctype="Purchase Order Item"]',function(e){M(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="item_name"][data-doctype="Purchase Order Item"]',function(e){G(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Purchase Order Item"]',function(e){G(t)}),t.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="qty"][data-doctype="Purchase Order Item"]',function(e){G(t),M(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Purchase Order Item"]',function(e){G(t),cur_frm.refresh_field("conversion_factor")}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Purchase Order Item"]',function(e){M(t,0,_),G(t),cur_frm.refresh_field("conversion_factor")}),cur_frm.fields_dict.supplier.$input.on("blur focusout",function(e){M(t,0,_)}),cur_frm.fields_dict.items.$wrapper.on("blur",function(e){G(t)}),cur_frm.fields_dict.taxes_and_charges.$input.on("blur focusout",function(e){M(t,0,_)})},facelec_po_nit:function(t){e(t.doc.facelec_po_nit,t.doc.supplier,t)},discount_amount:function(t){t.doc.facelec_po_total_iva;var e=t.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100);NaN==e||null==e||(discount_amount_tax_value=e*(cur_frm.doc.taxes[0].rate/100),t.doc.facelec_po_total_iva=t.doc.facelec_po_total_iva-discount_amount_tax_value)},before_save:function(t,e,_){G(t)}}),frappe.ui.form.on("Purchase Order Item",{items_remove:function(t){var e=0,_=0,a=0,o=0;$.each(t.doc.items||[],function(t,c){e+=flt(c.facelec_po_gt_tax_net_fuel_amt),_+=flt(c.facelec_po_gt_tax_net_goods_amt),a+=flt(c.facelec_po_gt_tax_net_services_amt),o+=flt(c.facelec_po_sales_tax_for_this_row)}),cur_frm.set_value("facelec_po_gt_tax_fuel",e),cur_frm.set_value("facelec_po_gt_tax_goods",_),cur_frm.set_value("facelec_po_gt_tax_services",a),cur_frm.set_value("facelec_po_total_iva",o)},item_code:function(t,e,_){cur_frm.doc.taxes[0].rate;refresh_field("qty")},qty:function(t,e,_){M(t,0,_)},conversion_factor:function(t,e,_){M(t,0,_)},rate:function(t,e,_){M(t,0,_)}}),frappe.ui.form.on("Supplier Quotation",{onload_post_render:function(t,e,_){t.fields_dict.items.grid.wrapper.on("focusout blur",'input[data-fieldname="item_code"][data-doctype="Supplier Quotation Item"]',function(e){j(t,0,_),U(t)}),t.fields_dict.items.grid.wrapper.on("click",'input[data-fieldname="uom"][data-doctype="Supplier Quotation Item"]',function(e){U(t)}),t.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="uom"][data-doctype="Supplier Quotation Item"]',function(e){U(t)}),t.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="uom"][data-doctype="Supplier Quotation Item"]',function(e){j(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="item_name"][data-doctype="Supplier Quotation Item"]',function(e){U(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Supplier Quotation Item"]',function(e){U(t)}),t.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="qty"][data-doctype="Supplier Quotation Item"]',function(e){U(t),j(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Supplier Quotation Item"]',function(e){U(t),cur_frm.refresh_field("conversion_factor")}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Supplier Quotation Item"]',function(e){j(t,0,_),U(t),cur_frm.refresh_field("conversion_factor")}),cur_frm.fields_dict.supplier.$input.on("blur focusout",function(e){j(t,0,_)}),cur_frm.fields_dict.items.$wrapper.on("blur",function(e){U(t)}),cur_frm.fields_dict.taxes_and_charges.$input.on("blur focusout",function(e){j(t,0,_)})},shs_spq_nit:function(t){e(t.doc.shs_spq_nit,t.doc.supplier,t)},discount_amount:function(t){t.doc.shs_spq_total_iva;var e=t.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100);NaN==e||null==e||(discount_amount_tax_value=e*(cur_frm.doc.taxes[0].rate/100),t.doc.shs_spq_total_iva=t.doc.shs_spq_total_iva-discount_amount_tax_value)},before_save:function(t,e,_){U(t)}}),frappe.ui.form.on("Supplier Quotation Item",{items_remove:function(t,e,_){var a=0,o=0,c=0,r=0;$.each(t.doc.items||[],function(t,e){a+=flt(e.shs_spq_gt_tax_net_fuel_amt),o+=flt(e.shs_spq_gt_tax_net_goods_amt),c+=flt(e.shs_spq_gt_tax_net_services_amt),r+=flt(e.shs_spq_sales_tax_for_this_row)}),cur_frm.set_value("shs_spq_gt_tax_fuel",a),cur_frm.set_value("shs_spq_gt_tax_goods",o),cur_frm.set_value("shs_spq_gt_tax_services",c),cur_frm.set_value("shs_spq_total_iva",r)},item_code:function(t,e,_){cur_frm.doc.taxes[0].rate;refresh_field("qty")},qty:function(t,e,_){j(t,0,_)},conversion_factor:function(t,e,_){j(t,0,_)},rate:function(t,e,_){j(t,0,_)}}),t.valNit=e,t.goalSeek=_,t}({});
//# sourceMappingURL=facelec.min.js.map
