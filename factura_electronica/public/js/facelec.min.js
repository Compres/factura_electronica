
/*
 *	/home/frappe/frappe-bench/apps/factura_electronica/factura_electronica/public/js/facelec.js
 */


frappe.ui.form.on("Sales Invoice", {
    refresh: function refresh(frm) {

        frappe.call({
            method: "factura_electronica.obtener_cae.obtenerDatoSales",
            args: {
                factura: frm.doc.name
            },
            callback: function callback(r) {
                frm.doc.cae_factura_electronica = r.message;
            }
        });
    }
});

frappe.ui.form.on("Sales Invoice", {

    refresh: function refresh(frm) {

        if (frm.doc.status === "Paid" || frm.doc.status === "Unpaid" || frm.doc.status === "Submitted") {
            if (frm.doc.cae_factura_electronica != " ") {
                cur_frm.clear_custom_buttons();
            } else {
                frm.add_custom_button(__('Factura Electronica'), function () {
                    frappe.call({
                        method: "factura_electronica.api.generar_factura_electronica",
                        args: {
                            serie_factura: frm.doc.name,
                            nombre_cliente: frm.doc.customer
                        },
                        callback: function callback(r) {
                            frm.reload_doc();
                        }
                    });
                }).addClass("btn-primary");
            }
        }
    }
});