var Rollup=function(t){"use strict";function e(t,e,_){if("C/F"===t||"c/f"===t)_.enable_save();else{var a,o=0;if(a=/^(\d+)\-?([\dk])$/i.exec(t)){a[2]="k"==a[2].toLowerCase()?10:parseInt(a[2]);for(var c=0;c<a[1].length;c++)o+=(-1*(c-a[1].length)+1)*a[1][c];var s=(11-o%11)%11==a[2]}else s=!1;!1===s&&(msgprint("NIT de: <b>"+e+"</b>, no es correcto. Si no tiene disponible el NIT modifiquelo a <b>C/F</b>"),_.disable_save()),!0===s&&_.enable_save()}}function _(t,e,_){var a;void 0===cur_frm.doc.taxes[0].rate||(a=cur_frm.doc.taxes[0].rate);t.doc.items.forEach(function(e,o){if(e.name===_){e.amount,e.stock_qty,e.facelec_tax_rate_per_uom,e.stock_qty*e.facelec_tax_rate_per_uom,e.amount-e.stock_qty*e.facelec_tax_rate_per_uom,t.doc.items[o].facelec_other_tax_amount=e.facelec_tax_rate_per_uom*(e.qty*e.conversion_factor),t.doc.items[o].facelec_amount_minus_excise_tax=e.qty*e.rate-e.stock_qty*e.facelec_tax_rate_per_uom,t.refresh_field("items"),t.refresh_field("conversion_factor"),e.factelecis_fuel&&(t.doc.items[o].facelec_gt_tax_net_fuel_amt=e.facelec_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_sales_tax_for_this_row=e.facelec_gt_tax_net_fuel_amt*(a/100)),e.facelec_is_good&&(t.doc.items[o].facelec_gt_tax_net_goods_amt=e.facelec_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_sales_tax_for_this_row=e.facelec_gt_tax_net_goods_amt*(a/100)),e.facelec_is_service&&(t.doc.items[o].facelec_gt_tax_net_services_amt=e.facelec_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_sales_tax_for_this_row=e.facelec_gt_tax_net_services_amt*(a/100));var c=0;$.each(t.doc.items||[],function(t,e){e.facelec_sales_tax_for_this_row&&(c+=flt(e.facelec_sales_tax_for_this_row))}),console.log("El total de iva acumulado para la factura es: "+c),cur_frm.set_value("shs_total_iva_fac",c)}})}function a(t,e,a){t.doc.items.forEach(function(e){t.doc.facelec_total_iva;var a=t.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100);if("NaN"==typeof cur_frm.doc.taxes[0].rate);else{var o=a*(cur_frm.doc.taxes[0].rate/100);t.doc.facelec_total_iva=t.doc.facelec_total_iva-o}_(t,0,e.name),i(t,"Sales Invoice Item",e.name)})}function o(t,e){var _=0;return $.each(t.doc.items||[],function(t,a){a.facelec_tax_rate_per_uom_account===e&&(_+=flt(a.facelec_other_tax_amount))}),_}function c(t,e,_){t.doc.items.forEach(function(e,a){e.name===_&&e.facelec_tax_rate_per_uom_account&&t.doc.shs_otros_impuestos.forEach(function(_,a){if(_.account_head===e.facelec_tax_rate_per_uom_account){var c;c=o(t,_.account_head),cur_frm.doc.shs_otros_impuestos[a].total=c,s(t)}})})}function s(t){var e=0;$.each(t.doc.shs_otros_impuestos||[],function(t,_){_.account_head&&(e+=flt(_.total))}),cur_frm.set_value("shs_total_otros_imp_incl",e),t.refresh_field("shs_total_otros_imp_incl")}function i(t,e,_){var a=0;t.doc.items.forEach(function(e,o){if(e.name===_){e.stock_qty*e.facelec_tax_rate_per_uom,a=e.facelec_other_tax_amount;var s=e.facelec_tax_rate_per_uom_account;t.refresh_field("items"),t.refresh_field("conversion_factor"),s&&(!function(t,e){var _=!1;return $.each(t.doc.shs_otros_impuestos||[],function(t,a){a.account_head===e&&(_=!0)}),_}(t,s)?(frappe.model.add_child(cur_frm.doc,"Otros Impuestos Factura Electronica","shs_otros_impuestos"),cur_frm.refresh_field("items"),t.doc.shs_otros_impuestos.forEach(function(e,o){void 0===e.account_head&&(cur_frm.doc.shs_otros_impuestos[o].account_head=s,cur_frm.doc.shs_otros_impuestos[o].total=a,cur_frm.refresh_field("shs_otros_impuestos"),c(t,0,_),cur_frm.refresh_field("shs_otros_impuestos"))})):(c(t,0,_),cur_frm.refresh_field("shs_otros_impuestos")))}})}function r(t,e){e.add_custom_button(__("VER PDF FACTURA ELECTRONICA"),function(){window.open("https://www.ingface.net/Ingfacereport/dtefactura.jsp?cae="+t)}).addClass("btn-primary")}function n(t){t.add_custom_button(__("GUARDAR PDF"),function(){frappe.call({method:"factura_electronica.api.guardar_pdf_servidor",args:{nombre_archivo:t.doc.name,cae_de_factura_electronica:t.doc.cae_factura_electronica},callback:function(){t.reload_doc()}})}).addClass("btn-primary")}function f(t,e){e.add_custom_button(__(t),function(){e.reload_doc();var t=e.doc.name,_=window.location.href;frappe.call({method:"factura_electronica.api.generar_factura_electronica",args:{serie_factura:e.doc.name,nombre_cliente:e.doc.customer,pre_se:e.doc.naming_series},callback:function(a){if(void 0!==a.message){var o=_.replace(t,a.message);window.location.assign(o),e.reload_doc()}}})}).addClass("btn-primary")}function u(t){t.reload_doc();var e=t.doc.name,_=window.location.href;frappe.call({method:"factura_electronica.api.generar_factura_electronica",args:{serie_factura:t.doc.name,nombre_cliente:t.doc.customer,pre_se:t.doc.naming_series},callback:function(a){if(void 0!==a.message){var o=_.replace(e,a.message);window.location.assign(o),t.reload_doc()}else t.reload_doc()}})}function d(t,e,_,a){"Paid"!==e.doc.status&&"Unpaid"!==e.doc.status&&"Submitted"!==e.doc.status&&"Overdue"!==e.doc.status||(e.doc.cae_factura_electronica?(cur_frm.clear_custom_buttons(),r(e.doc.cae_factura_electronica,e),n(e)):("manual"===t&&f("Factura Electronica",e),"automatico"===t&&u(e))),"Return"===e.doc.status&&(e.doc.cae_factura_electronica?(cur_frm.clear_custom_buttons(),r(e.doc.cae_factura_electronica,e),n(e)):("manual"===t&&f("Nota Credito Electronica",e),"automatico"===t&&u(e))),"Paid"!==e.doc.status&&"Unpaid"!==e.doc.status&&"Submitted"!==e.doc.status&&"Overdue"!==e.doc.status||e.doc.es_nota_de_debito&&(cur_frm.clear_custom_buttons("Factura Electronica"),e.doc.cae_factura_electronica?(cur_frm.clear_custom_buttons(),r(e.doc.cae_factura_electronica,e),n(e)):("manual"===t&&f("Nota Debito Electronica",e),"automatico"===t&&u(e))),"Draft"===e.doc.status&&(cur_frm.set_value("cae_factura_electronica",""),cur_frm.set_value("serie_original_del_documento",""))}function l(t,e){return t*e}function m(t,e,_){t.doc.items.forEach(function(e){p(t,"Delivery Note Item",e.name)})}function p(t,e,_){cur_frm.refresh_fields();var a=cur_frm.doc.taxes[0].rate;t.doc.items.forEach(function(e,o){if(e.name==_){if(e.qty*e.rate,e.qty*e.conversion_factor,e.shs_dn_tax_rate_per_uom,t.doc.items[o].shs_dn_other_tax_amount=e.shs_dn_tax_rate_per_uom*(e.qty*e.conversion_factor),t.doc.items[o].shs_dn_amount_minus_excise_tax=e.qty*e.rate-e.qty*e.conversion_factor*e.shs_dn_tax_rate_per_uom,e.shs_dn_is_fuel){t.doc.items[o].shs_dn_gt_tax_net_fuel_amt=e.shs_dn_amount_minus_excise_tax/(1+a/100),t.doc.items[o].shs_dn_sales_tax_for_this_row=e.shs_dn_gt_tax_net_fuel_amt*(a/100);var c=0;$.each(t.doc.items||[],function(t,e){1==e.shs_dn_is_fuel&&(c+=flt(e.shs_dn_gt_tax_net_fuel_amt))}),t.doc.shs_dn_gt_tax_fuel=c}if(e.shs_dn_is_good){t.doc.items[o].shs_dn_gt_tax_net_goods_amt=e.shs_dn_amount_minus_excise_tax/(1+a/100),t.doc.items[o].shs_dn_sales_tax_for_this_row=e.shs_dn_gt_tax_net_goods_amt*(a/100);var s=0;$.each(t.doc.items||[],function(t,e){1==e.shs_dn_is_good&&(s+=flt(e.shs_dn_gt_tax_net_goods_amt))}),t.doc.shs_dn_gt_tax_goods=s}if(e.shs_dn_is_service){t.doc.items[o].shs_dn_gt_tax_net_services_amt=e.shs_dn_amount_minus_excise_tax/(1+a/100),t.doc.items[o].shs_dn_sales_tax_for_this_row=e.shs_dn_gt_tax_net_services_amt*(a/100);var i=0;$.each(t.doc.items||[],function(t,e){1==e.shs_dn_is_service&&(i+=flt(e.shs_dn_gt_tax_net_services_amt))}),t.doc.shs_dn_gt_tax_services=i}var r=0;$.each(t.doc.items||[],function(t,e){r+=flt(e.shs_dn_sales_tax_for_this_row)}),t.doc.shs_dn_total_iva=r}})}function x(t,e){return t*e}function h(t,e,_){t.doc.items.forEach(function(e){v(t,"Sales Order Item",e.name)})}function v(t,e,_){cur_frm.refresh_fields();var a=cur_frm.doc.taxes[0].rate;t.doc.items.forEach(function(e,o){if(e.name==_){if(e.qty*e.rate,e.qty*e.conversion_factor,e.shs_so_tax_rate_per_uom,t.doc.items[o].shs_so_other_tax_amount=e.shs_so_tax_rate_per_uom*(e.qty*e.conversion_factor),t.doc.items[o].shs_so_amount_minus_excise_tax=e.qty*e.rate-e.qty*e.conversion_factor*e.shs_so_tax_rate_per_uom,e.shs_so_is_fuel){t.doc.items[o].shs_so_gt_tax_net_fuel_amt=e.shs_so_amount_minus_excise_tax/(1+a/100),t.doc.items[o].shs_so_sales_tax_for_this_row=e.shs_so_gt_tax_net_fuel_amt*(a/100);var c=0;$.each(t.doc.items||[],function(t,e){1==e.shs_so_is_fuel&&(c+=flt(e.shs_so_gt_tax_net_fuel_amt))}),t.doc.shs_gt_tax_fuel=c}if(e.shs_so_is_good){t.doc.items[o].shs_so_gt_tax_net_goods_amt=e.shs_so_amount_minus_excise_tax/(1+a/100),t.doc.items[o].shs_so_sales_tax_for_this_row=e.shs_so_gt_tax_net_goods_amt*(a/100);var s=0;$.each(t.doc.items||[],function(t,e){1==e.shs_so_is_good&&(s+=flt(e.shs_so_gt_tax_net_goods_amt))}),t.doc.shs_so_gt_tax_goods=s}if(e.shs_so_is_service){t.doc.items[o].shs_so_gt_tax_net_services_amt=e.shs_so_amount_minus_excise_tax/(1+a/100),t.doc.items[o].shs_so_sales_tax_for_this_row=e.shs_so_gt_tax_net_services_amt*(a/100);var i=0;$.each(t.doc.items||[],function(t,e){1==e.shs_so_is_service&&(i+=flt(e.shs_so_gt_tax_net_services_amt))}),t.doc.shs_so_gt_tax_services=i}var r=0;$.each(t.doc.items||[],function(t,e){r+=flt(e.shs_so_sales_tax_for_this_row)}),t.doc.shs_so_total_iva=r}})}function g(t,e,_){t.doc.items.forEach(function(e){b(t,"Quotation Item",e.name),I(t,"Quotation Item",e.name)})}function y(t,e){var _=0;return $.each(t.doc.items||[],function(t,a){a.facelec_qt_tax_rate_per_uom_account===e&&(_+=flt(a.facelec_qt_other_tax_amount))}),_}function q(t,e,_){t.doc.items.forEach(function(e,a){e.name===_&&e.facelec_qt_tax_rate_per_uom_account&&t.doc.shs_tax_quotation.forEach(function(_,a){if(_.account_head===e.facelec_qt_tax_rate_per_uom_account){var o;o=y(t,_.account_head),cur_frm.doc.shs_tax_quotation[a].total=o,w(t)}})})}function w(t){var e=0;$.each(t.doc.shs_tax_quotation||[],function(t,_){_.account_head&&(e+=flt(_.total))}),cur_frm.set_value("shs_qt_total_otros_imp_incl",e),t.refresh_field("shs_qt_total_otros_imp_incl")}function I(t,e,_){var a=0;t.doc.items.forEach(function(e,o){if(e.name===_){a=e.facelec_qt_other_tax_amount;var c=e.facelec_qt_tax_rate_per_uom_account;t.refresh_field("items"),t.refresh_field("conversion_factor"),c&&(!function(t,e){var _=!1;return $.each(t.doc.shs_tax_quotation||[],function(t,a){a.account_head===e&&(_=!0)}),_}(t,c)?(frappe.model.add_child(cur_frm.doc,"Otros Impuestos Factura Electronica","shs_tax_quotation"),cur_frm.refresh_field("items"),t.doc.shs_tax_quotation.forEach(function(e,o){void 0===e.account_head&&(cur_frm.doc.shs_tax_quotation[o].account_head=c,cur_frm.doc.shs_tax_quotation[o].total=a,cur_frm.refresh_field("shs_tax_quotation"),q(t,0,_),cur_frm.refresh_field("shs_tax_quotation"))})):(q(t,0,_),cur_frm.refresh_field("shs_tax_quotation")))}})}function b(t,e,_){cur_frm.refresh_fields();var a=cur_frm.doc.taxes[0].rate;t.doc.items.forEach(function(e,o){e.name==_&&(e.qty*e.rate,e.qty*e.conversion_factor,e.facelec_qt_tax_rate_per_uom,t.doc.items[o].facelec_qt_other_tax_amount=e.facelec_qt_tax_rate_per_uom*(e.qty*e.conversion_factor),t.doc.items[o].facelec_qt_amount_minus_excise_tax=e.qty*e.rate-e.qty*e.conversion_factor*e.facelec_qt_tax_rate_per_uom,e.facelec_qt_is_fuel&&(t.doc.items[o].facelec_qt_gt_tax_net_fuel_amt=e.facelec_qt_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_qt_sales_tax_for_this_row=e.facelec_qt_gt_tax_net_fuel_amt*(a/100),total_fuel=0,$.each(t.doc.items||[],function(t,e){1==e.facelec_qt_is_fuel&&(total_fuel+=flt(e.facelec_qt_gt_tax_net_fuel_amt))}),t.doc.facelec_qt_gt_tax_fuel=total_fuel),e.facelec_qt_is_good&&(t.doc.items[o].facelec_qt_gt_tax_net_goods_amt=e.facelec_qt_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_qt_sales_tax_for_this_row=e.facelec_qt_gt_tax_net_goods_amt*(a/100),total_goods=0,$.each(t.doc.items||[],function(t,e){1==e.facelec_qt_is_good&&(total_goods+=flt(e.facelec_qt_gt_tax_net_goods_amt))}),t.doc.facelec_qt_gt_tax_goods=total_goods),1==e.facelec_qt_is_service&&(t.doc.items[o].facelec_qt_gt_tax_net_services_amt=e.facelec_qt_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_qt_sales_tax_for_this_row=e.facelec_qt_gt_tax_net_services_amt*(a/100),total_servi=0,$.each(t.doc.items||[],function(t,e){1==e.facelec_qt_is_service&&(total_servi+=flt(e.facelec_qt_gt_tax_net_services_amt))}),t.doc.facelec_qt_gt_tax_services=total_servi),full_tax_iva=0,$.each(t.doc.items||[],function(t,e){full_tax_iva+=flt(e.facelec_qt_sales_tax_for_this_row)}),t.doc.facelec_qt_total_iva=full_tax_iva)})}function k(t,e,_){t.doc.items.forEach(function(e){O(t,"Purchase Invoice Item",e.name),N(t,"Purchase Invoice Item",e.name)})}function E(t,e){var _=0;return $.each(t.doc.items||[],function(t,a){a.facelec_p_tax_rate_per_uom_account===e&&(_+=flt(a.facelec_p_other_tax_amount))}),_}function P(t,e,_){t.doc.items.forEach(function(e,a){e.name===_&&e.facelec_p_tax_rate_per_uom_account&&t.doc.shs_pi_otros_impuestos.forEach(function(_,a){if(_.account_head===e.facelec_p_tax_rate_per_uom_account){var o;o=E(t,_.account_head),cur_frm.doc.shs_pi_otros_impuestos[a].total=o,S(t)}})})}function S(t){var e=0;$.each(t.doc.shs_pi_otros_impuestos||[],function(t,_){_.account_head&&(e+=flt(_.total))}),cur_frm.set_value("shs_pi_total_otros_imp_incl",e),t.refresh_field("shs_pi_total_otros_imp_incl")}function N(t,e,_){var a=0;t.doc.items.forEach(function(e,o){if(e.name===_){a=e.facelec_p_other_tax_amount;var c=e.facelec_p_tax_rate_per_uom_account;t.refresh_field("items"),t.refresh_field("conversion_factor"),c&&(!function(t,e){var _=!1;return $.each(t.doc.shs_pi_otros_impuestos||[],function(t,a){a.account_head===e&&(_=!0)}),_}(t,c)?(frappe.model.add_child(cur_frm.doc,"Otros Impuestos Factura Electronica","shs_pi_otros_impuestos"),cur_frm.refresh_field("items"),t.doc.shs_pi_otros_impuestos.forEach(function(e,o){void 0===e.account_head&&(cur_frm.doc.shs_pi_otros_impuestos[o].account_head=c,cur_frm.doc.shs_pi_otros_impuestos[o].total=a,cur_frm.refresh_field("shs_pi_otros_impuestos"),P(t,0,_),cur_frm.refresh_field("shs_pi_otros_impuestos"))})):(P(t,0,_),cur_frm.refresh_field("shs_pi_otros_impuestos")))}})}function O(t,e,_){cur_frm.refresh_fields();var a=cur_frm.doc.taxes[0].rate;t.doc.items.forEach(function(e,o){e.name==_&&(e.qty*e.rate,e.qty*e.conversion_factor,e.facelec_p_tax_rate_per_uom,t.doc.items[o].facelec_p_other_tax_amount=e.facelec_p_tax_rate_per_uom*(e.qty*e.conversion_factor),t.doc.items[o].facelec_p_amount_minus_excise_tax=e.qty*e.rate-e.qty*e.conversion_factor*e.facelec_p_tax_rate_per_uom,e.facelec_p_is_fuel&&(t.doc.items[o].facelec_p_gt_tax_net_fuel_amt=e.facelec_p_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_p_sales_tax_for_this_row=e.facelec_p_gt_tax_net_fuel_amt*(a/100),total_fuel=0,$.each(t.doc.items||[],function(t,e){1==e.facelec_p_is_fuel&&(total_fuel+=flt(e.facelec_p_gt_tax_net_fuel_amt))}),t.doc.facelec_p_gt_tax_fuel=total_fuel),e.facelec_p_is_good&&(t.doc.items[o].facelec_p_gt_tax_net_goods_amt=e.facelec_p_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_p_sales_tax_for_this_row=e.facelec_p_gt_tax_net_goods_amt*(a/100),total_goods=0,$.each(t.doc.items||[],function(t,e){1==e.facelec_p_is_good&&(total_goods+=flt(e.facelec_p_gt_tax_net_goods_amt))}),t.doc.facelec_p_gt_tax_goods=total_goods),1==e.facelec_p_is_service&&(t.doc.items[o].facelec_p_gt_tax_net_services_amt=e.facelec_p_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_p_sales_tax_for_this_row=e.facelec_p_gt_tax_net_services_amt*(a/100),total_servi=0,$.each(t.doc.items||[],function(t,e){1==e.facelec_p_is_service&&(total_servi+=flt(e.facelec_p_gt_tax_net_services_amt))}),t.doc.facelec_p_gt_tax_services=total_servi),full_tax_iva=0,$.each(t.doc.items||[],function(t,e){full_tax_iva+=flt(e.facelec_p_sales_tax_for_this_row)}),t.doc.facelec_p_total_iva=full_tax_iva)})}function Q(t,e){return t*e}function F(t,e,_){t.doc.items.forEach(function(e){R(t,"Purchase Receipt Item",e.name)})}function R(t,e,_){cur_frm.refresh_fields();var a=cur_frm.doc.taxes[0].rate;t.doc.items.forEach(function(e,o){if(e.name==_){if(e.qty*e.rate,e.qty*e.conversion_factor,e.facelec_pr_tax_rate_per_uom,t.doc.items[o].facelec_pr_other_tax_amount=e.facelec_pr_tax_rate_per_uom*(e.qty*e.conversion_factor),t.doc.items[o].facelec_pr_amount_minus_excise_tax=e.qty*e.rate-e.qty*e.conversion_factor*e.facelec_pr_tax_rate_per_uom,e.facelec_pr_is_fuel){t.doc.items[o].facelec_pr_gt_tax_net_fuel_amt=e.facelec_pr_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_pr_sales_tax_for_this_row=e.facelec_pr_gt_tax_net_fuel_amt*(a/100);var c=0;$.each(t.doc.items||[],function(t,e){1==e.facelec_pr_is_fuel&&(c+=flt(e.facelec_pr_gt_tax_net_fuel_amt))}),t.doc.facelec_pr_gt_tax_fuel=c}if(e.facelec_pr_is_good){t.doc.items[o].facelec_pr_gt_tax_net_goods_amt=e.facelec_pr_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_pr_sales_tax_for_this_row=e.facelec_pr_gt_tax_net_goods_amt*(a/100);var s=0;$.each(t.doc.items||[],function(t,e){1==e.facelec_pr_is_good&&(s+=flt(e.facelec_pr_gt_tax_net_goods_amt))}),t.doc.facelec_pr_gt_tax_goods=s}if(e.facelec_pr_is_service){t.doc.items[o].facelec_pr_gt_tax_net_services_amt=e.facelec_pr_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_pr_sales_tax_for_this_row=e.facelec_pr_gt_tax_net_services_amt*(a/100);var i=0;$.each(t.doc.items||[],function(t,e){1==e.facelec_pr_is_service&&(i+=flt(e.facelec_pr_gt_tax_net_services_amt))}),t.doc.facelec_pr_gt_tax_services=i}var r=0;$.each(t.doc.items||[],function(t,e){r+=flt(e.facelec_pr_sales_tax_for_this_row)}),t.doc.facelec_pr_total_iva=r}})}function D(t,e){return t*e}function A(t,e,_){t.doc.items.forEach(function(e){C(t,"Purchase Order Item",e.name)})}function C(t,e,_){cur_frm.refresh_fields();var a=cur_frm.doc.taxes[0].rate;t.doc.items.forEach(function(e,o){if(e.name==_){if(e.qty*e.rate,e.qty*e.conversion_factor,e.facelec_po_tax_rate_per_uom,t.doc.items[o].facelec_po_other_tax_amount=e.facelec_po_tax_rate_per_uom*(e.qty*e.conversion_factor),t.doc.items[o].facelec_po_amount_minus_excise_tax=e.qty*e.rate-e.qty*e.conversion_factor*e.facelec_po_tax_rate_per_uom,e.facelec_po_is_fuel){t.doc.items[o].facelec_po_gt_tax_net_fuel_amt=e.facelec_po_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_po_sales_tax_for_this_row=e.facelec_po_gt_tax_net_fuel_amt*(a/100);var c=0;$.each(t.doc.items||[],function(t,e){1==e.facelec_po_is_fuel&&(c+=flt(e.facelec_po_gt_tax_net_fuel_amt))}),t.doc.facelec_po_gt_tax_fuel=c}if(e.facelec_po_is_good){t.doc.items[o].facelec_po_gt_tax_net_goods_amt=e.facelec_po_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_po_sales_tax_for_this_row=e.facelec_po_gt_tax_net_goods_amt*(a/100);var s=0;$.each(t.doc.items||[],function(t,e){1==e.facelec_po_is_good&&(s+=flt(e.facelec_po_gt_tax_net_goods_amt))}),t.doc.facelec_po_gt_tax_goods=s}if(e.facelec_po_is_service){t.doc.items[o].facelec_po_gt_tax_net_services_amt=e.facelec_po_amount_minus_excise_tax/(1+a/100),t.doc.items[o].facelec_po_sales_tax_for_this_row=e.facelec_po_gt_tax_net_services_amt*(a/100);var i=0;$.each(t.doc.items||[],function(t,e){1==e.facelec_po_is_service&&(i+=flt(e.facelec_po_gt_tax_net_services_amt))}),t.doc.facelec_po_gt_tax_services=i}var r=0;$.each(t.doc.items||[],function(t,e){r+=flt(e.facelec_po_sales_tax_for_this_row)}),t.doc.facelec_po_total_iva=r}})}function T(t,e,_){t.doc.items.forEach(function(e){G(t,"Supplier Quotation Item",e.name)})}function G(t,e,_){cur_frm.refresh_fields();var a=cur_frm.doc.taxes[0].rate;t.doc.items.forEach(function(e,o){if(e.name==_){if(e.qty*e.rate,e.qty*e.conversion_factor,e.shs_spq_tax_rate_per_uom,t.doc.items[o].shs_spq_other_tax_amount=e.shs_spq_tax_rate_per_uom*(e.qty*e.conversion_factor),t.doc.items[o].shs_spq_amount_minus_excise_tax=e.qty*e.rate-e.qty*e.conversion_factor*e.shs_spq_tax_rate_per_uom,e.shs_spq_is_fuel){t.doc.items[o].shs_spq_gt_tax_net_fuel_amt=e.shs_spq_amount_minus_excise_tax/(1+a/100),t.doc.items[o].shs_spq_sales_tax_for_this_row=e.shs_spq_gt_tax_net_fuel_amt*(a/100);var c=0;$.each(t.doc.items||[],function(t,e){1==e.shs_spq_is_fuel&&(c+=flt(e.shs_spq_gt_tax_net_fuel_amt))}),t.doc.shs_spq_gt_tax_fuel=c}if(e.shs_spq_is_good){t.doc.items[o].shs_spq_gt_tax_net_goods_amt=e.shs_spq_amount_minus_excise_tax/(1+a/100),t.doc.items[o].shs_spq_sales_tax_for_this_row=e.shs_spq_gt_tax_net_goods_amt*(a/100);var s=0;$.each(t.doc.items||[],function(t,e){1==e.shs_spq_is_good&&(s+=flt(e.shs_spq_gt_tax_net_goods_amt))}),t.doc.shs_spq_gt_tax_goods=s}if(e.shs_spq_is_service){t.doc.items[o].shs_spq_gt_tax_net_services_amt=e.shs_spq_amount_minus_excise_tax/(1+a/100),t.doc.items[o].shs_spq_sales_tax_for_this_row=e.shs_spq_gt_tax_net_services_amt*(a/100);var i=0;$.each(t.doc.items||[],function(t,e){1==e.shs_spq_is_service&&(i+=flt(e.shs_spq_gt_tax_net_services_amt))}),t.doc.shs_spq_gt_tax_services=i}var r=0;$.each(t.doc.items||[],function(t,e){r+=flt(e.shs_spq_sales_tax_for_this_row)}),t.doc.shs_spq_total_iva=r}})}return console.log("Se cargo exitosamente la aplicación de Factura Electrónica"),frappe.ui.form.on("Item",{facelec_is_fuel:function(t,e,_){t.doc.facelec_is_fuel&&(cur_frm.set_value("facelec_is_good",0),cur_frm.set_value("facelec_is_service",0))},facelec_is_good:function(t,e,_){t.doc.facelec_is_good&&(cur_frm.set_value("facelec_is_fuel",0),cur_frm.set_value("facelec_is_service",0))},facelec_is_service:function(t,e,_){t.doc.facelec_is_service&&(cur_frm.set_value("facelec_is_fuel",0),cur_frm.set_value("facelec_is_good",0))}}),frappe.ui.form.on("Sales Invoice",{onload_post_render:function(t,e,o){t.fields_dict.items.grid.wrapper.on("click focusout blur",'input[data-fieldname="item_code"][data-doctype="Sales Invoice Item"]',function(e){a(t),_(t,0,o)}),t.fields_dict.items.grid.wrapper.on("click",'input[data-fieldname="uom"][data-doctype="Sales Invoice Item"]',function(e){a(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="uom"][data-doctype="Sales Invoice Item"]',function(e){a(t)}),t.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="uom"][data-doctype="Sales Invoice Item"]',function(e){_(t,0,o)}),t.fields_dict.items.grid.wrapper.on("focus",'input[data-fieldname="item_name"][data-doctype="Sales Invoice Item"]',function(e){a(t),i(t,0,o)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Sales Invoice Item"]',function(e){a(t)}),t.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="qty"][data-doctype="Sales Invoice Item"]',function(e){a(t),_(t,0,o)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Sales Invoice Item"]',function(e){a(t),cur_frm.refresh_field("conversion_factor")}),t.fields_dict.items.grid.wrapper.on("mouseleave focusout",'input[data-fieldname="conversion_factor"][data-doctype="Sales Invoice Item"]',function(e){_(t,0,o),a(t),cur_frm.refresh_field("conversion_factor")}),t.fields_dict.items.grid.wrapper.on("blur",'input[data-fieldname="rate"][data-doctype="Sales Invoice Item"]',function(t){}),cur_frm.fields_dict.customer.$input.on("keyup",function(e){_(t,0,o),a(t),refresh_field("qty")}),cur_frm.fields_dict.customer.$input.on("mouseleave blur focusout",function(e){_(t,0,o)}),cur_frm.fields_dict.taxes_and_charges.$input.on("focusout",function(e){_(t,0,o),i(t,0,o)})},customer:function(t,e,_){},refresh:function(t,e,a){cur_frm.add_fetch("customer","nit_face_customer","nit_face_customer"),t.add_custom_button("UOM Recalculation",function(){t.doc.items.forEach(function(e){_(t,0,e.name)})}),d("manual",t)},validate:function(t){!function(t){if(t.doc.items.length>0){var e=t.doc.items,_=Array.from(e);frappe.call({method:"factura_electronica.api.generar_tabla_html",args:{tabla:JSON.stringify(_)},callback:function(e){t.set_value("other_tax_facelec",e.message),t.refresh_field("other_tax_facelec")}})}}(t)},nit_face_customer:function(t,_,a){e(t.doc.nit_face_customer,t.doc.customer,t)},taxes_and_charges:function(t,e,_){},additional_discount_percentage:function(t,e,_){},discount_amount:function(t,e,_){t.doc.facelec_total_iva;var a=t.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100);if(NaN==a||null==a);else{var o=a*(cur_frm.doc.taxes[0].rate/100);t.doc.facelec_total_iva=t.doc.facelec_total_iva-o}},before_save:function(t,e,_){a(t),i(t,0,_)},on_submit:function(t,e,_){var a={};t.doc.shs_otros_impuestos.forEach(function(t,e){t.account_head&&(a[t.account_head]=t.total)}),Object.keys(a).length>0?frappe.call({method:"factura_electronica.special_tax.add_gl_entry_other_special_tax",args:{invoice_name:t.doc.name,accounts:a,invoice_type:"Sales Invoice"},callback:function(){t.reload_doc(),frappe.call({method:"factura_electronica.api.obtenerConfiguracionManualAutomatica",callback:function(e){e.message,"Automatico"===e.message&&d("automatico",t)}})}}):frappe.call({method:"factura_electronica.api.obtenerConfiguracionManualAutomatica",callback:function(e){e.message,"Automatico"===e.message&&d("automatico",t)}})},naming_series:function(t,e,_){frappe.call({method:"factura_electronica.api.obtener_numero_resolucion",args:{nombre_serie:t.doc.naming_series},callback:function(t){void 0===t.message?cur_frm.set_value("shs_numero_resolucion",""):cur_frm.set_value("shs_numero_resolucion",t.message)}})}}),frappe.ui.form.on("Sales Invoice Item",{items_add:function(t,e,_){},items_move:function(t,e,_){},before_items_remove:function(t,e,_){t.doc.items.forEach(function(e,a){e.name==_&&function(t,e,_,a){console.log("Otro Impuesto recibido es : "+a),t.doc.items.forEach(function(e,c){if(e.facelec_tax_rate_per_uom_account===_){var i=o(t,_)-a;t.doc.shs_otros_impuestos.forEach(function(e,a){e.account_head===_&&(cur_frm.doc.shs_otros_impuestos[a].total=i,cur_frm.refresh_field("shs_otros_impuestos"),s(t),cur_frm.refresh_field("shs_otros_impuestos"),e.total||(cur_frm.doc.shs_otros_impuestos.splice(cur_frm.doc.shs_otros_impuestos[a],1),cur_frm.refresh_field("shs_otros_impuestos")))})}})}(t,0,e.facelec_tax_rate_per_uom_account,e.facelec_other_tax_amount)})},items_remove:function(t,e,_){},item_code:function(t,e,_){a(t)},qty:function(t,e,a){_(t,0,a)},uom:function(t,e,_){},conversion_factor:function(t,e,a){_(t,0,a)},facelec_tax_rate_per_uom_account:function(t,e,_){},rate:function(t,e,a){_(t,0,a)},shs_amount_for_back_calc:function(t,e,_){t.doc.items.forEach(function(e,_){var a=e.rate,o=e.qty,c=(e.amount,goalSeek({Func:l,aFuncParams:[o,a],oFuncArgTarget:{Position:0},Goal:e.shs_amount_for_back_calc,Tol:.001,maxIter:1e4}));console.log(c),t.doc.items[_].qty=c,t.doc.items[_].amount=c*t.doc.items[_].rate,t.refresh_field("items")})}}),frappe.ui.form.on("Delivery Note",{onload_post_render:function(t,e,_){t.fields_dict.items.grid.wrapper.on("click focusout blur",'input[data-fieldname="item_code"][data-doctype="Delivery Note Item"]',function(e){p(t,0,_),m(t)}),t.fields_dict.items.grid.wrapper.on("click",'input[data-fieldname="uom"][data-doctype="Delivery Note Item"]',function(e){m(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="uom"][data-doctype="Delivery Note Item"]',function(e){m(t)}),t.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="uom"][data-doctype="Delivery Note Item"]',function(e){p(t,0,_)}),t.fields_dict.items.grid.wrapper.on("focus",'input[data-fieldname="item_name"][data-doctype="Delivery Note Item"]',function(e){m(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Delivery Note Item"]',function(e){m(t)}),t.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="qty"][data-doctype="Delivery Note Item"]',function(e){m(t),p(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Delivery Note Item"]',function(e){m(t),cur_frm.refresh_field("conversion_factor")}),t.fields_dict.items.grid.wrapper.on("keyup mouseleave focusout",'input[data-fieldname="conversion_factor"][data-doctype="Delivery Note Item"]',function(e){p(t,0,_),m(t),cur_frm.refresh_field("conversion_factor")}),cur_frm.fields_dict.customer.$input.on("mouseleave blur focusout",function(e){p(t,0,_)}),cur_frm.fields_dict.items.$wrapper.on("click",function(e){m(t)}),cur_frm.fields_dict.taxes_and_charges.$input.on("focusout",function(e){p(t,0,_)})},shs_dn_nit:function(t){valNit(t.doc.shs_dn_nit,t.doc.customer,t)},discount_amount:function(t){tax_before_calc=t.doc.shs_dn_total_iva,discount_amount_net_value=t.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100),NaN==discount_amount_net_value||null==discount_amount_net_value||(discount_amount_tax_value=discount_amount_net_value*(cur_frm.doc.taxes[0].rate/100),t.doc.shs_dn_total_iva=t.doc.shs_dn_total_iva-discount_amount_tax_value)},before_save:function(t,e,_){m(t)}}),frappe.ui.form.on("Delivery Note Item",{items_remove:function(t){fix_gt_tax_fuel=0,fix_gt_tax_goods=0,fix_gt_tax_services=0,fix_gt_tax_iva=0,$.each(t.doc.items||[],function(t,e){fix_gt_tax_fuel+=flt(e.shs_dn_gt_tax_net_fuel_amt),fix_gt_tax_goods+=flt(e.shs_dn_gt_tax_net_goods_amt),fix_gt_tax_services+=flt(e.shs_dn_gt_tax_net_services_amt),fix_gt_tax_iva+=flt(e.shs_dn_sales_tax_for_this_row)}),cur_frm.set_value("shs_dn_gt_tax_fuel",fix_gt_tax_fuel),cur_frm.set_value("shs_dn_gt_tax_goods",fix_gt_tax_goods),cur_frm.set_value("shs_dn_gt_tax_services",fix_gt_tax_services),cur_frm.set_value("shs_dn_total_iva",fix_gt_tax_iva)},item_code:function(t,e,_){this_company_sales_tax_var=cur_frm.doc.taxes[0].rate,refresh_field("qty")},qty:function(t,e,_){p(t,0,_)},conversion_factor:function(t,e,_){p(t,0,_)},rate:function(t,e,_){p(t,0,_)},shs_amount_for_back_calc:function(t,e,_){t.doc.items.forEach(function(e,_){var a=e.rate,o=e.qty,c=(e.amount,goalSeek({Func:x,aFuncParams:[o,a],oFuncArgTarget:{Position:0},Goal:e.shs_amount_for_back_calc,Tol:.001,maxIter:1e4}));console.log(c),t.doc.items[_].qty=c,t.doc.items[_].amount=c*t.doc.items[_].rate,t.refresh_field("items")})}}),frappe.ui.form.on("Sales Order",{onload_post_render:function(t,e,_){t.fields_dict.items.grid.wrapper.on("click focusout blur",'input[data-fieldname="item_code"][data-doctype="Sales Order Item"]',function(e){v(t,0,_),h(t)}),t.fields_dict.items.grid.wrapper.on("click",'input[data-fieldname="uom"][data-doctype="Sales Order Item"]',function(e){h(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="uom"][data-doctype="Sales Order Item"]',function(e){h(t)}),t.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="uom"][data-doctype="Sales Order Item"]',function(e){v(t,0,_)}),t.fields_dict.items.grid.wrapper.on("focus",'input[data-fieldname="item_name"][data-doctype="Sales Order Item"]',function(e){h(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Sales Order Item"]',function(e){h(t)}),t.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="qty"][data-doctype="Sales Order Item"]',function(e){h(t),v(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Sales Order Item"]',function(e){h(t),cur_frm.refresh_field("conversion_factor")}),t.fields_dict.items.grid.wrapper.on("keyup mouseleave focusout",'input[data-fieldname="conversion_factor"][data-doctype="Sales Order Item"]',function(e){v(t,0,_),h(t),cur_frm.refresh_field("conversion_factor")}),cur_frm.fields_dict.customer.$input.on("keyup",function(t){}),cur_frm.fields_dict.customer.$input.on("mouseleave blur focusout",function(e){v(t,0,_)}),cur_frm.fields_dict.items.$wrapper.on("click",function(e){h(t)}),cur_frm.fields_dict.taxes_and_charges.$input.on("focusout",function(e){v(t,0,_)})},shs_so_nit:function(t){valNit(t.doc.shs_so_nit,t.doc.customer,t)},discount_amount:function(t){tax_before_calc=t.doc.shs_so_total_iva,discount_amount_net_value=t.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100),NaN==discount_amount_net_value||null==discount_amount_net_value||(discount_amount_tax_value=discount_amount_net_value*(cur_frm.doc.taxes[0].rate/100),t.doc.shs_so_total_iva=t.doc.shs_so_total_iva-discount_amount_tax_value)},before_save:function(t,e,_){h(t)}}),frappe.ui.form.on("Sales Order Item",{items_remove:function(t){fix_gt_tax_fuel=0,fix_gt_tax_goods=0,fix_gt_tax_services=0,fix_gt_tax_iva=0,$.each(t.doc.items||[],function(t,e){fix_gt_tax_fuel+=flt(e.shs_so_gt_tax_net_fuel_amt),fix_gt_tax_goods+=flt(e.shs_so_gt_tax_net_goods_amt),fix_gt_tax_services+=flt(e.shs_so_gt_tax_net_services_amt),fix_gt_tax_iva+=flt(e.shs_so_sales_tax_for_this_row)}),cur_frm.set_value("shs_gt_tax_fuel",fix_gt_tax_fuel),cur_frm.set_value("shs_so_gt_tax_goods",fix_gt_tax_goods),cur_frm.set_value("shs_so_gt_tax_services",fix_gt_tax_services),cur_frm.set_value("shs_so_total_iva",fix_gt_tax_iva)},item_code:function(t,e,_){this_company_sales_tax_var=cur_frm.doc.taxes[0].rate,refresh_field("qty")},qty:function(t,e,_){v(t,0,_)},conversion_factor:function(t,e,_){v(t,0,_)},rate:function(t,e,_){v(t,0,_)}}),frappe.ui.form.on("Quotation",{onload_post_render:function(t,e,_){t.fields_dict.items.grid.wrapper.on("click focusout blur",'input[data-fieldname="item_code"][data-doctype="Quotation Item"]',function(e){b(t,0,_),g(t)}),t.fields_dict.items.grid.wrapper.on("click",'input[data-fieldname="uom"][data-doctype="Quotation Item"]',function(e){g(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="uom"][data-doctype="Quotation Item"]',function(e){g(t)}),t.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="uom"][data-doctype="Quotation Item"]',function(e){b(t,0,_)}),t.fields_dict.items.grid.wrapper.on("focus",'input[data-fieldname="item_name"][data-doctype="Quotation Item"]',function(e){g(t),I(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Quotation Item"]',function(e){g(t)}),t.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="qty"][data-doctype="Quotation Item"]',function(e){g(t),b(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Quotation Item"]',function(e){g(t),cur_frm.refresh_field("conversion_factor")}),t.fields_dict.items.grid.wrapper.on("keyup mouseleave focusout",'input[data-fieldname="conversion_factor"][data-doctype="Quotation Item"]',function(e){b(t,0,_),g(t),cur_frm.refresh_field("conversion_factor")}),cur_frm.fields_dict.customer.$input.on("keyup",function(t){}),cur_frm.fields_dict.customer.$input.on("mouseleave blur focusout",function(e){b(t,0,_)}),cur_frm.fields_dict.items.$wrapper.on("click",function(e){g(t)}),cur_frm.fields_dict.taxes_and_charges.$input.on("focusout",function(e){b(t,0,_),I(t,0,_)})},facelec_qt_nit:function(t,e,_){valNit(t.doc.facelec_qt_nit,t.doc.customer,t)},discount_amount:function(t,e,_){tax_before_calc=t.doc.facelec_total_iva,discount_amount_net_value=t.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100),NaN==discount_amount_net_value||null==discount_amount_net_value||(discount_amount_tax_value=discount_amount_net_value*(cur_frm.doc.taxes[0].rate/100),t.doc.facelec_total_iva=t.doc.facelec_total_iva-discount_amount_tax_value)},before_save:function(t,e,_){g(t),I(t,0,_)}}),frappe.ui.form.on("Quotation Item",{before_items_remove:function(t,e,_){t.doc.items.forEach(function(e,a){e.name==_&&function(t,e,_){t.doc.items.forEach(function(a,o){if(a.facelec_qt_tax_rate_per_uom_account===e){var c=y(t,e)-_;t.doc.shs_tax_quotation.forEach(function(_,a){_.account_head===e&&(cur_frm.doc.shs_tax_quotation[a].total=c,cur_frm.refresh_field("shs_tax_quotation"),w(t),cur_frm.refresh_field("shs_tax_quotation"),0===_.total&&(cur_frm.doc.shs_tax_quotation.splice(cur_frm.doc.shs_tax_quotation[a],1),cur_frm.refresh_field("shs_tax_quotation")))})}})}(t,e.facelec_qt_tax_rate_per_uom_account,e.facelec_qt_other_tax_amount)})},items_remove:function(t,e,_){fix_gt_tax_fuel=0,fix_gt_tax_goods=0,fix_gt_tax_services=0,fix_gt_tax_iva=0,$.each(t.doc.items||[],function(t,e){fix_gt_tax_fuel+=flt(e.facelec_qt_gt_tax_net_fuel_amt),fix_gt_tax_goods+=flt(e.facelec_qt_gt_tax_net_goods_amt),fix_gt_tax_services+=flt(e.facelec_qt_gt_tax_net_services_amt),fix_gt_tax_iva+=flt(e.facelec_qt_sales_tax_for_this_row)}),cur_frm.set_value("facelec_qt_gt_tax_fuel",fix_gt_tax_fuel),cur_frm.set_value("facelec_qt_gt_tax_goods",fix_gt_tax_goods),cur_frm.set_value("facelec_qt_gt_tax_services",fix_gt_tax_services),cur_frm.set_value("facelec_qt_total_iva",fix_gt_tax_iva)},item_code:function(t,e,_){this_company_sales_tax_var=cur_frm.doc.taxes[0].rate,refresh_field("qty")},qty:function(t,e,_){b(t,0,_)},uom:function(t,e,_){},conversion_factor:function(t,e,_){b(t,0,_)},rate:function(t,e,_){b(t,0,_)}}),frappe.ui.form.on("Purchase Invoice",{onload_post_render:function(t,e,_){t.fields_dict.items.grid.wrapper.on("click focusout blur",'input[data-fieldname="item_code"][data-doctype="Purchase Invoice Item"]',function(e){O(t,0,_),k(t)}),t.fields_dict.items.grid.wrapper.on("click",'input[data-fieldname="uom"][data-doctype="Purchase Invoice Item"]',function(e){k(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="uom"][data-doctype="Purchase Invoice Item"]',function(e){k(t)}),t.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="uom"][data-doctype="Purchase Invoice Item"]',function(e){O(t,0,_)}),t.fields_dict.items.grid.wrapper.on("focus",'input[data-fieldname="item_name"][data-doctype="Purchase Invoice Item"]',function(e){k(t),N(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Purchase Invoice Item"]',function(e){k(t)}),t.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="qty"][data-doctype="Purchase Invoice Item"]',function(e){k(t),O(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Purchase Invoice Item"]',function(e){k(t),cur_frm.refresh_field("conversion_factor")}),t.fields_dict.items.grid.wrapper.on("keyup mouseleave focusout",'input[data-fieldname="conversion_factor"][data-doctype="Purchase Invoice Item"]',function(e){O(t,0,_),k(t),cur_frm.refresh_field("conversion_factor")}),cur_frm.fields_dict.supplier.$input.on("keyup",function(t){}),cur_frm.fields_dict.supplier.$input.on("mouseleave blur focusout",function(e){O(t,0,_)}),cur_frm.fields_dict.items.$wrapper.on("click",function(e){k(t)}),cur_frm.fields_dict.taxes_and_charges.$input.on("focusout",function(e){O(t,0,_),N(t,0,_)})},facelec_nit_fproveedor:function(t,e,_){valNit(t.doc.facelec_nit_fproveedor,t.doc.supplier,t)},discount_amount:function(t,e,_){tax_before_calc=t.doc.facelec_total_iva,discount_amount_net_value=t.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100),NaN==discount_amount_net_value||null==discount_amount_net_value||(discount_amount_tax_value=discount_amount_net_value*(cur_frm.doc.taxes[0].rate/100),t.doc.facelec_total_iva=t.doc.facelec_total_iva-discount_amount_tax_value)},before_save:function(t,e,_){k(t),N(t,0,_)},validate:function(t){!function(t){if(t.doc.items.length>0){var e=t.doc.items,_=Array.from(e);frappe.call({method:"factura_electronica.api.generar_tabla_html_factura_compra",args:{tabla:JSON.stringify(_)},callback:function(e){t.set_value("other_tax_facelec",e.message),t.refresh_field("other_tax_facelec")}})}}(t)},on_submit:function(t,e,_){var a={};t.doc.shs_pi_otros_impuestos.forEach(function(t,e){t.account_head&&(a[t.account_head]=t.total)}),Object.keys(a).length>0&&frappe.call({method:"factura_electronica.special_tax.add_gl_entry_other_special_tax",args:{invoice_name:t.doc.name,accounts:a,invoice_type:"Purchase Invoice"},callback:function(){}})},naming_series:function(t,e,_){console.log(t.doc.naming_series),frappe.call({method:"factura_electronica.special_invoice.verificar_existencia_series",args:{serie:t.doc.naming_series},callback:function(e){console.log(e.message),"fail"!=e.message&&(cur_frm.clear_table("taxes"),cur_frm.refresh_fields(),t.set_value("taxes_and_charges",e.message[2]),t.refresh_field("taxes_and_charges"))}})}}),frappe.ui.form.on("Purchase Invoice Item",{before_items_remove:function(t,e,_){t.doc.items.forEach(function(e,a){e.name==_&&function(t,e,_){t.doc.items.forEach(function(a,o){if(a.facelec_p_tax_rate_per_uom_account===e){var c=E(t,e)-_;t.doc.shs_pi_otros_impuestos.forEach(function(_,a){_.account_head===e&&(cur_frm.doc.shs_pi_otros_impuestos[a].total=c,cur_frm.refresh_field("shs_pi_otros_impuestos"),S(t),cur_frm.refresh_field("shs_pi_otros_impuestos"),_.total||(cur_frm.doc.shs_pi_otros_impuestos.splice(cur_frm.doc.shs_pi_otros_impuestos[a],1),cur_frm.refresh_field("shs_pi_otros_impuestos")))})}})}(t,e.facelec_p_tax_rate_per_uom_account,e.facelec_p_other_tax_amount)})},items_remove:function(t,e,_){fix_gt_tax_fuel=0,fix_gt_tax_goods=0,fix_gt_tax_services=0,fix_gt_tax_iva=0,$.each(t.doc.items||[],function(t,e){fix_gt_tax_fuel+=flt(e.facelec_p_gt_tax_net_fuel_amt),fix_gt_tax_goods+=flt(e.facelec_p_gt_tax_net_goods_amt),fix_gt_tax_services+=flt(e.facelec_p_gt_tax_net_services_amt),fix_gt_tax_iva+=flt(e.facelec_p_sales_tax_for_this_row)}),cur_frm.set_value("facelec_p_gt_tax_fuel",fix_gt_tax_fuel),cur_frm.set_value("facelec_p_gt_tax_goods",fix_gt_tax_goods),cur_frm.set_value("facelec_p_gt_tax_services",fix_gt_tax_services),cur_frm.set_value("facelec_p_total_iva",fix_gt_tax_iva)},item_code:function(t,e,_){this_company_sales_tax_var=cur_frm.doc.taxes[0].rate,refresh_field("qty")},qty:function(t,e,_){O(t,0,_)},uom:function(t,e,_){},conversion_factor:function(t,e,_){O(t,0,_)},rate:function(t,e,_){O(t,0,_)},shs_amount_for_back_calc:function(t,e,_){t.doc.items.forEach(function(e,a){console.log(e.rate),console.log(e.qty),console.log(e.amount);var o=e.rate,c=e.qty,s=(e.amount,goalSeek({Func:Q,aFuncParams:[c,o],oFuncArgTarget:{Position:0},Goal:e.shs_amount_for_back_calc,Tol:.001,maxIter:1e4}));console.log(s),t.doc.items[a].qty=s,t.doc.items[a].amount=s*t.doc.items[a].rate,t.refresh_field("items"),k(t),N(t,0,_)})}}),frappe.ui.form.on("Purchase Receipt",{onload_post_render:function(t,e,_){t.fields_dict.items.grid.wrapper.on("click focusout blur",'input[data-fieldname="item_code"][data-doctype="Purchase Receipt Item"]',function(e){R(t,0,_),F(t)}),t.fields_dict.items.grid.wrapper.on("click",'input[data-fieldname="uom"][data-doctype="Purchase Receipt Item"]',function(e){F(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="uom"][data-doctype="Purchase Receipt Item"]',function(e){F(t)}),t.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="uom"][data-doctype="Purchase Receipt Item"]',function(e){R(t,0,_)}),t.fields_dict.items.grid.wrapper.on("focus",'input[data-fieldname="item_name"][data-doctype="Purchase Receipt Item"]',function(e){F(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Purchase Receipt Item"]',function(e){F(t)}),t.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="qty"][data-doctype="Purchase Receipt Item"]',function(e){F(t),R(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Purchase Receipt Item"]',function(e){F(t),cur_frm.refresh_field("conversion_factor")}),t.fields_dict.items.grid.wrapper.on("keyup mouseleave focusout",'input[data-fieldname="conversion_factor"][data-doctype="Purchase Receipt Item"]',function(e){R(t,0,_),F(t),cur_frm.refresh_field("conversion_factor")}),cur_frm.fields_dict.supplier.$input.on("keyup",function(t){}),cur_frm.fields_dict.supplier.$input.on("mouseleave blur focusout",function(e){R(t,0,_)}),cur_frm.fields_dict.items.$wrapper.on("click",function(e){F(t)}),cur_frm.fields_dict.taxes_and_charges.$input.on("focusout",function(e){R(t,0,_)})},facelec_nit_prproveedor:function(t){valNit(t.doc.facelec_nit_prproveedor,t.doc.supplier,t)},discount_amount:function(t){tax_before_calc=t.doc.facelec_pr_total_iva,discount_amount_net_value=t.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100),NaN==discount_amount_net_value||null==discount_amount_net_value||(discount_amount_tax_value=discount_amount_net_value*(cur_frm.doc.taxes[0].rate/100),t.doc.facelec_pr_total_iva=t.doc.facelec_pr_total_iva-discount_amount_tax_value)},before_save:function(t,e,_){F(t)}}),frappe.ui.form.on("Purchase Receipt Item",{items_remove:function(t){fix_gt_tax_fuel=0,fix_gt_tax_goods=0,fix_gt_tax_services=0,fix_gt_tax_iva=0,$.each(t.doc.items||[],function(t,e){fix_gt_tax_fuel+=flt(e.facelec_pr_gt_tax_net_fuel_amt),fix_gt_tax_goods+=flt(e.facelec_pr_gt_tax_net_goods_amt),fix_gt_tax_services+=flt(e.facelec_pr_gt_tax_net_services_amt),fix_gt_tax_iva+=flt(e.facelec_pr_sales_tax_for_this_row)}),cur_frm.set_value("facelec_pr_gt_tax_fuel",fix_gt_tax_fuel),cur_frm.set_value("facelec_pr_gt_tax_goods",fix_gt_tax_goods),cur_frm.set_value("facelec_pr_gt_tax_services",fix_gt_tax_services),cur_frm.set_value("facelec_pr_total_iva",fix_gt_tax_iva)},item_code:function(t,e,_){this_company_sales_tax_var=cur_frm.doc.taxes[0].rate,refresh_field("qty")},qty:function(t,e,_){R(t,0,_)},conversion_factor:function(t,e,_){R(t,0,_)},rate:function(t,e,_){R(t,0,_)},shs_amount_for_back_calc:function(t,e,_){t.doc.items.forEach(function(e,_){var a=e.rate,o=e.qty,c=(e.amount,goalSeek({Func:D,aFuncParams:[o,a],oFuncArgTarget:{Position:0},Goal:e.shs_amount_for_back_calc,Tol:.001,maxIter:1e4}));console.log(c),t.doc.items[_].qty=c,t.doc.items[_].amount=c*t.doc.items[_].rate,t.refresh_field("items")})}}),frappe.ui.form.on("Purchase Order",{onload_post_render:function(t,e,_){t.fields_dict.items.grid.wrapper.on("click focusout blur",'input[data-fieldname="item_code"][data-doctype="Purchase Order Item"]',function(e){C(t,0,_),A(t)}),t.fields_dict.items.grid.wrapper.on("click",'input[data-fieldname="uom"][data-doctype="Purchase Order Item"]',function(e){A(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="uom"][data-doctype="Purchase Order Item"]',function(e){A(t)}),t.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="uom"][data-doctype="Purchase Order Item"]',function(e){C(t,0,_)}),t.fields_dict.items.grid.wrapper.on("focus",'input[data-fieldname="item_name"][data-doctype="Purchase Order Item"]',function(e){A(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Purchase Order Item"]',function(e){A(t)}),t.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="qty"][data-doctype="Purchase Order Item"]',function(e){A(t),C(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Purchase Order Item"]',function(e){A(t),cur_frm.refresh_field("conversion_factor")}),t.fields_dict.items.grid.wrapper.on("keyup mouseleave focusout",'input[data-fieldname="conversion_factor"][data-doctype="Purchase Order Item"]',function(e){C(t,0,_),A(t),cur_frm.refresh_field("conversion_factor")}),cur_frm.fields_dict.supplier.$input.on("keyup",function(t){}),cur_frm.fields_dict.supplier.$input.on("mouseleave blur focusout",function(e){C(t,0,_)}),cur_frm.fields_dict.items.$wrapper.on("click",function(e){A(t)}),cur_frm.fields_dict.taxes_and_charges.$input.on("focusout",function(e){C(t,0,_)})},facelec_po_nit:function(t){valNit(t.doc.facelec_po_nit,t.doc.supplier,t)},discount_amount:function(t){tax_before_calc=t.doc.facelec_po_total_iva,discount_amount_net_value=t.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100),NaN==discount_amount_net_value||null==discount_amount_net_value||(discount_amount_tax_value=discount_amount_net_value*(cur_frm.doc.taxes[0].rate/100),t.doc.facelec_po_total_iva=t.doc.facelec_po_total_iva-discount_amount_tax_value)},before_save:function(t,e,_){A(t)}}),frappe.ui.form.on("Purchase Order Item",{items_remove:function(t){fix_gt_tax_fuel=0,fix_gt_tax_goods=0,fix_gt_tax_services=0,fix_gt_tax_iva=0,$.each(t.doc.items||[],function(t,e){fix_gt_tax_fuel+=flt(e.facelec_po_gt_tax_net_fuel_amt),fix_gt_tax_goods+=flt(e.facelec_po_gt_tax_net_goods_amt),fix_gt_tax_services+=flt(e.facelec_po_gt_tax_net_services_amt),fix_gt_tax_iva+=flt(e.facelec_po_sales_tax_for_this_row)}),cur_frm.set_value("facelec_po_gt_tax_fuel",fix_gt_tax_fuel),cur_frm.set_value("facelec_po_gt_tax_goods",fix_gt_tax_goods),cur_frm.set_value("facelec_po_gt_tax_services",fix_gt_tax_services),cur_frm.set_value("facelec_po_total_iva",fix_gt_tax_iva)},item_code:function(t,e,_){this_company_sales_tax_var=cur_frm.doc.taxes[0].rate,refresh_field("qty")},qty:function(t,e,_){C(t,0,_)},conversion_factor:function(t,e,_){C(t,0,_)},rate:function(t,e,_){C(t,0,_)}}),frappe.ui.form.on("Supplier Quotation",{onload_post_render:function(t,e,_){t.fields_dict.items.grid.wrapper.on("click focusout blur",'input[data-fieldname="item_code"][data-doctype="Supplier Quotation Item"]',function(e){G(t,0,_),T(t)}),t.fields_dict.items.grid.wrapper.on("click",'input[data-fieldname="uom"][data-doctype="Supplier Quotation Item"]',function(e){T(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="uom"][data-doctype="Supplier Quotation Item"]',function(e){T(t)}),t.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="uom"][data-doctype="Supplier Quotation Item"]',function(e){G(t,0,_)}),t.fields_dict.items.grid.wrapper.on("focus",'input[data-fieldname="item_name"][data-doctype="Supplier Quotation Item"]',function(e){T(t)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="qty"][data-doctype="Supplier Quotation Item"]',function(e){T(t)}),t.fields_dict.items.grid.wrapper.on("mouseleave",'input[data-fieldname="qty"][data-doctype="Supplier Quotation Item"]',function(e){T(t),G(t,0,_)}),t.fields_dict.items.grid.wrapper.on("blur focusout",'input[data-fieldname="conversion_factor"][data-doctype="Supplier Quotation Item"]',function(e){T(t),cur_frm.refresh_field("conversion_factor")}),t.fields_dict.items.grid.wrapper.on("keyup mouseleave focusout",'input[data-fieldname="conversion_factor"][data-doctype="Supplier Quotation Item"]',function(e){G(t,0,_),T(t),cur_frm.refresh_field("conversion_factor")}),cur_frm.fields_dict.supplier.$input.on("keyup",function(t){}),cur_frm.fields_dict.supplier.$input.on("mouseleave blur focusout",function(e){G(t,0,_)}),cur_frm.fields_dict.items.$wrapper.on("click",function(e){T(t)}),cur_frm.fields_dict.taxes_and_charges.$input.on("focusout",function(e){G(t,0,_)})},shs_spq_nit:function(t){valNit(t.doc.shs_spq_nit,t.doc.supplier,t)},discount_amount:function(t){tax_before_calc=t.doc.shs_spq_total_iva,discount_amount_net_value=t.doc.discount_amount/(1+cur_frm.doc.taxes[0].rate/100),NaN==discount_amount_net_value||null==discount_amount_net_value||(discount_amount_tax_value=discount_amount_net_value*(cur_frm.doc.taxes[0].rate/100),t.doc.shs_spq_total_iva=t.doc.shs_spq_total_iva-discount_amount_tax_value)},before_save:function(t,e,_){T(t)}}),frappe.ui.form.on("Supplier Quotation Item",{items_remove:function(t,e,_){fix_gt_tax_fuel=0,fix_gt_tax_goods=0,fix_gt_tax_services=0,fix_gt_tax_iva=0,$.each(t.doc.items||[],function(t,e){fix_gt_tax_fuel+=flt(e.shs_spq_gt_tax_net_fuel_amt),fix_gt_tax_goods+=flt(e.shs_spq_gt_tax_net_goods_amt),fix_gt_tax_services+=flt(e.shs_spq_gt_tax_net_services_amt),fix_gt_tax_iva+=flt(e.shs_spq_sales_tax_for_this_row)}),cur_frm.set_value("shs_spq_gt_tax_fuel",fix_gt_tax_fuel),cur_frm.set_value("shs_spq_gt_tax_goods",fix_gt_tax_goods),cur_frm.set_value("shs_spq_gt_tax_services",fix_gt_tax_services),cur_frm.set_value("shs_spq_total_iva",fix_gt_tax_iva)},item_code:function(t,e,_){this_company_sales_tax_var=cur_frm.doc.taxes[0].rate,refresh_field("qty")},qty:function(t,e,_){G(t,0,_)},conversion_factor:function(t,e,_){G(t,0,_)},rate:function(t,e,_){G(t,0,_)}}),t.valNit=e,t}({});
//# sourceMappingURL=facelec.min.js.map
